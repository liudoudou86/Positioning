"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var cn=Object.create;var at=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var hn=Object.getOwnPropertyNames;var dn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var pn=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var gn=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hn(e))!fn.call(n,o)&&o!==t&&at(n,o,{get:()=>e[o],enumerable:!(s=ln(e,o))||s.enumerable});return n};var mn=(n,e,t)=>(t=n!=null?cn(dn(n)):{},gn(e||!n||!n.__esModule?at(t,"default",{value:n,enumerable:!0}):t,n));var C=(n,e,t)=>new Promise((s,o)=>{var i=l=>{try{u(t.next(l))}catch(a){o(a)}},r=l=>{try{u(t.throw(l))}catch(a){o(a)}},u=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,r);u((t=t.apply(n,e)).next())});var an=pn((eo,rn)=>{rn.exports=Vue});var yn=Object.defineProperty,_n=Object.defineProperties,An=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,wn=Object.prototype.hasOwnProperty,Fn=Object.prototype.propertyIsEnumerable,ct=(n,e,t)=>e in n?yn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,x=(n,e)=>{for(var t in e||(e={}))wn.call(e,t)&&ct(n,t,e[t]);if(ut)for(var t of ut(e))Fn.call(e,t)&&ct(n,t,e[t]);return n},oe=(n,e)=>_n(n,An(e)),vn=Object.prototype.toString,Dt=n=>vn.call(n),Ot=n=>Dt(n).slice(8,-1);function En(){return typeof __channelId__=="string"&&__channelId__}function kn(n,e){switch(Ot(e)){case"Function":return"function() { [native code] }";default:return e}}function Tn(n,e,t){return En()?(t.push(e.replace("at ","uni-app:///")),console[n].apply(console,t)):t.map(function(o){let i=Dt(o).toLowerCase();if(["[object object]","[object array]","[object module]"].indexOf(i)!==-1)try{o="---BEGIN:JSON---"+JSON.stringify(o,kn)+"---END:JSON---"}catch(r){o=i}else if(o===null)o="---NULL---";else if(o===void 0)o="---UNDEFINED---";else{let r=Ot(o).toUpperCase();r==="NUMBER"||r==="BOOLEAN"?o="---BEGIN:"+r+"---"+o+"---END:"+r+"---":o=String(o)}return o}).join("---COMMA---")+" "+e}function N(n,e,...t){let s=Tn(n,e,t);s&&console[n](s)}var Sn=n=>n!==null&&typeof n=="object",Pn=["{","}"],Ke=class{constructor(){this._caches=Object.create(null)}interpolate(e,t,s=Pn){if(!t)return[e];let o=this._caches[e];return o||(o=Dn(e,s),this._caches[e]=o),On(o,t)}},Cn=/^(?:\d)+/,In=/^(?:\w)+/;function Dn(n,[e,t]){let s=[],o=0,i="";for(;o<n.length;){let r=n[o++];if(r===e){i&&s.push({type:"text",value:i}),i="";let u="";for(r=n[o++];r!==void 0&&r!==t;)u+=r,r=n[o++];let l=r===t,a=Cn.test(u)?"list":l&&In.test(u)?"named":"unknown";s.push({value:u,type:a})}else i+=r}return i&&s.push({type:"text",value:i}),s}function On(n,e){let t=[],s=0,o=Array.isArray(e)?"list":Sn(e)?"named":"unknown";if(o==="unknown")return t;for(;s<n.length;){let i=n[s];switch(i.type){case"text":t.push(i.value);break;case"list":t.push(e[parseInt(i.value,10)]);break;case"named":o==="named"&&t.push(e[i.value]);break}s++}return t}var Be="zh-Hans",lt="zh-Hant",Q="en",bn="fr",xn="es",Ln=Object.prototype.hasOwnProperty,ht=(n,e)=>Ln.call(n,e),Un=new Ke;function Bn(n,e){return!!e.find(t=>n.indexOf(t)!==-1)}function Rn(n,e){return e.find(t=>n.indexOf(t)===0)}function dt(n,e){if(!n)return;if(n=n.trim().replace(/_/g,"-"),e&&e[n])return n;if(n=n.toLowerCase(),n==="chinese")return Be;if(n.indexOf("zh")===0)return n.indexOf("-hans")>-1?Be:n.indexOf("-hant")>-1||Bn(n,["-tw","-hk","-mo","-cht"])?lt:Be;let t=Rn(n,[Q,bn,xn]);if(t)return t}var He=class{constructor({locale:e,fallbackLocale:t,messages:s,watcher:o,formater:i}){this.locale=Q,this.fallbackLocale=Q,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=i||Un,this.messages=s||{},this.setLocale(e||Q),o&&this.watchLocale(o)}setLocale(e){let t=this.locale;this.locale=dt(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach(s=>{s(this.locale,t)})}getLocale(){return this.locale}watchLocale(e){let t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,s=!0){let o=this.messages[e];o?s?Object.assign(o,t):Object.keys(t).forEach(i=>{ht(o,i)||(o[i]=t[i])}):this.messages[e]=t}f(e,t,s){return this.formater.interpolate(e,t,s).join("")}t(e,t,s){let o=this.message;return typeof t=="string"?(t=dt(t,this.messages),t&&(o=this.messages[t])):s=t,ht(o,e)?this.formater.interpolate(o[e],s).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}};function Nn(n,e){n.$watchLocale?n.$watchLocale(t=>{e.setLocale(t)}):n.$watch(()=>n.$locale,t=>{e.setLocale(t)})}function qn(){return typeof uni!="undefined"&&uni.getLocale?uni.getLocale():typeof global!="undefined"&&global.getLocale?global.getLocale():Q}function jn(n,e={},t,s){typeof n!="string"&&([n,e]=[e,n]),typeof n!="string"&&(n=qn()),typeof t!="string"&&(t=typeof __uniConfig!="undefined"&&__uniConfig.fallbackLocale||Q);let o=new He({locale:n,fallbackLocale:t,messages:e,watcher:s}),i=(r,u)=>{if(typeof getApp!="function")i=function(l,a){return o.t(l,a)};else{let l=!1;i=function(a,d){let _=getApp().$vm;return _&&(_.$locale,l||(l=!0,Nn(_,o))),o.t(a,d)}}return i(r,u)};return{i18n:o,f(r,u,l){return o.f(r,u,l)},t(r,u){return i(r,u)},add(r,u,l=!0){return o.add(r,u,l)},watch(r){return o.watchLocale(r)},getLocale(){return o.getLocale()},setLocale(r){return o.setLocale(r)}}}var Mn=[{path:"pages/index/index",style:{navigationBarTitleText:"\u5B9E\u65F6\u5B9A\u4F4D"}},{path:"pages/map/map",style:{navigationBarTitleText:"\u5386\u53F2\u8DB3\u8FF9"}},{path:"pages/setting/setting",style:{navigationBarTitleText:"\u7528\u6237\u8BBE\u7F6E"}},{path:"pages/setting/confirm/confirm",style:{navigationBarTitleText:"\u67E5\u770B\u7528\u6237"}},{path:"pages/setting/register/register",style:{navigationBarTitleText:"\u6CE8\u518C\u7528\u6237"}}],$n={navigationBarTextStyle:"black",navigationBarTitleText:"uni-app",navigationBarBackgroundColor:"#F8F8F8",backgroundColor:"#F8F8F8"},Kn={color:"#7A7E83",selectedColor:"#007AFF",borderStyle:"black",backgroundColor:"#F8F8F8",list:[{pagePath:"pages/index/index",iconPath:"static/icons/component.png",selectedIconPath:"static/icons/componentHL.png",text:"\u5B9A\u4F4D"},{pagePath:"pages/map/map",iconPath:"static/icons/extui.png",selectedIconPath:"static/icons/extuiHL.png",text:"\u8DB3\u8FF9"},{pagePath:"pages/setting/setting",iconPath:"static/icons/template.png",selectedIconPath:"static/icons/templateHL.png",text:"\u8BBE\u7F6E"}]},bt={pages:Mn,globalStyle:$n,tabBar:Kn};function Hn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function te(n,e,t){return n(t={path:e,exports:{},require:function(s,o){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(o==null&&t.path)}},t.exports),t.exports}var Re=te(function(n,e){var t;n.exports=(t=t||function(s,o){var i=Object.create||function(){function c(){}return function(h){var E;return c.prototype=h,E=new c,c.prototype=null,E}}(),r={},u=r.lib={},l=u.Base={extend:function(c){var h=i(this);return c&&h.mixIn(c),h.hasOwnProperty("init")&&this.init!==h.init||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var h in c)c.hasOwnProperty(h)&&(this[h]=c[h]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}},a=u.WordArray=l.extend({init:function(c,h){c=this.words=c||[],this.sigBytes=h!=o?h:4*c.length},toString:function(c){return(c||_).stringify(this)},concat:function(c){var h=this.words,E=c.words,v=this.sigBytes,A=c.sigBytes;if(this.clamp(),v%4)for(var k=0;k<A;k++){var S=E[k>>>2]>>>24-k%4*8&255;h[v+k>>>2]|=S<<24-(v+k)%4*8}else for(k=0;k<A;k+=4)h[v+k>>>2]=E[k>>>2];return this.sigBytes+=A,this},clamp:function(){var c=this.words,h=this.sigBytes;c[h>>>2]&=4294967295<<32-h%4*8,c.length=s.ceil(h/4)},clone:function(){var c=l.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var h,E=[],v=function(S){S=S;var O=987654321,I=4294967295;return function(){var H=((O=36969*(65535&O)+(O>>16)&I)<<16)+(S=18e3*(65535&S)+(S>>16)&I)&I;return H/=4294967296,(H+=.5)*(s.random()>.5?1:-1)}},A=0;A<c;A+=4){var k=v(4294967296*(h||s.random()));h=987654071*k(),E.push(4294967296*k()|0)}return new a.init(E,c)}}),d=r.enc={},_=d.Hex={stringify:function(c){for(var h=c.words,E=c.sigBytes,v=[],A=0;A<E;A++){var k=h[A>>>2]>>>24-A%4*8&255;v.push((k>>>4).toString(16)),v.push((15&k).toString(16))}return v.join("")},parse:function(c){for(var h=c.length,E=[],v=0;v<h;v+=2)E[v>>>3]|=parseInt(c.substr(v,2),16)<<24-v%8*4;return new a.init(E,h/2)}},w=d.Latin1={stringify:function(c){for(var h=c.words,E=c.sigBytes,v=[],A=0;A<E;A++){var k=h[A>>>2]>>>24-A%4*8&255;v.push(String.fromCharCode(k))}return v.join("")},parse:function(c){for(var h=c.length,E=[],v=0;v<h;v++)E[v>>>2]|=(255&c.charCodeAt(v))<<24-v%4*8;return new a.init(E,h)}},F=d.Utf8={stringify:function(c){try{return decodeURIComponent(escape(w.stringify(c)))}catch(h){throw new Error("Malformed UTF-8 data")}},parse:function(c){return w.parse(unescape(encodeURIComponent(c)))}},T=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=F.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var h=this._data,E=h.words,v=h.sigBytes,A=this.blockSize,k=v/(4*A),S=(k=c?s.ceil(k):s.max((0|k)-this._minBufferSize,0))*A,O=s.min(4*S,v);if(S){for(var I=0;I<S;I+=A)this._doProcessBlock(E,I);var H=E.splice(0,S);h.sigBytes-=O}return new a.init(H,O)},clone:function(){var c=l.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});u.Hasher=T.extend({cfg:l.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){return c&&this._append(c),this._doFinalize()},blockSize:16,_createHelper:function(c){return function(h,E){return new c.init(E).finalize(h)}},_createHmacHelper:function(c){return function(h,E){return new f.HMAC.init(c,E).finalize(h)}}});var f=r.algo={};return r}(Math),t)}),Wn=(te(function(n,e){var t;n.exports=(t=Re,function(s){var o=t,i=o.lib,r=i.WordArray,u=i.Hasher,l=o.algo,a=[];(function(){for(var f=0;f<64;f++)a[f]=4294967296*s.abs(s.sin(f+1))|0})();var d=l.MD5=u.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(f,c){for(var h=0;h<16;h++){var E=c+h,v=f[E];f[E]=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8)}var A=this._hash.words,k=f[c+0],S=f[c+1],O=f[c+2],I=f[c+3],H=f[c+4],he=f[c+5],de=f[c+6],fe=f[c+7],pe=f[c+8],ge=f[c+9],me=f[c+10],ye=f[c+11],_e=f[c+12],Ae=f[c+13],we=f[c+14],Fe=f[c+15],p=A[0],y=A[1],g=A[2],m=A[3];p=_(p,y,g,m,k,7,a[0]),m=_(m,p,y,g,S,12,a[1]),g=_(g,m,p,y,O,17,a[2]),y=_(y,g,m,p,I,22,a[3]),p=_(p,y,g,m,H,7,a[4]),m=_(m,p,y,g,he,12,a[5]),g=_(g,m,p,y,de,17,a[6]),y=_(y,g,m,p,fe,22,a[7]),p=_(p,y,g,m,pe,7,a[8]),m=_(m,p,y,g,ge,12,a[9]),g=_(g,m,p,y,me,17,a[10]),y=_(y,g,m,p,ye,22,a[11]),p=_(p,y,g,m,_e,7,a[12]),m=_(m,p,y,g,Ae,12,a[13]),g=_(g,m,p,y,we,17,a[14]),p=w(p,y=_(y,g,m,p,Fe,22,a[15]),g,m,S,5,a[16]),m=w(m,p,y,g,de,9,a[17]),g=w(g,m,p,y,ye,14,a[18]),y=w(y,g,m,p,k,20,a[19]),p=w(p,y,g,m,he,5,a[20]),m=w(m,p,y,g,me,9,a[21]),g=w(g,m,p,y,Fe,14,a[22]),y=w(y,g,m,p,H,20,a[23]),p=w(p,y,g,m,ge,5,a[24]),m=w(m,p,y,g,we,9,a[25]),g=w(g,m,p,y,I,14,a[26]),y=w(y,g,m,p,pe,20,a[27]),p=w(p,y,g,m,Ae,5,a[28]),m=w(m,p,y,g,O,9,a[29]),g=w(g,m,p,y,fe,14,a[30]),p=F(p,y=w(y,g,m,p,_e,20,a[31]),g,m,he,4,a[32]),m=F(m,p,y,g,pe,11,a[33]),g=F(g,m,p,y,ye,16,a[34]),y=F(y,g,m,p,we,23,a[35]),p=F(p,y,g,m,S,4,a[36]),m=F(m,p,y,g,H,11,a[37]),g=F(g,m,p,y,fe,16,a[38]),y=F(y,g,m,p,me,23,a[39]),p=F(p,y,g,m,Ae,4,a[40]),m=F(m,p,y,g,k,11,a[41]),g=F(g,m,p,y,I,16,a[42]),y=F(y,g,m,p,de,23,a[43]),p=F(p,y,g,m,ge,4,a[44]),m=F(m,p,y,g,_e,11,a[45]),g=F(g,m,p,y,Fe,16,a[46]),p=T(p,y=F(y,g,m,p,O,23,a[47]),g,m,k,6,a[48]),m=T(m,p,y,g,fe,10,a[49]),g=T(g,m,p,y,we,15,a[50]),y=T(y,g,m,p,he,21,a[51]),p=T(p,y,g,m,_e,6,a[52]),m=T(m,p,y,g,I,10,a[53]),g=T(g,m,p,y,me,15,a[54]),y=T(y,g,m,p,S,21,a[55]),p=T(p,y,g,m,pe,6,a[56]),m=T(m,p,y,g,Fe,10,a[57]),g=T(g,m,p,y,de,15,a[58]),y=T(y,g,m,p,Ae,21,a[59]),p=T(p,y,g,m,H,6,a[60]),m=T(m,p,y,g,ye,10,a[61]),g=T(g,m,p,y,O,15,a[62]),y=T(y,g,m,p,ge,21,a[63]),A[0]=A[0]+p|0,A[1]=A[1]+y|0,A[2]=A[2]+g|0,A[3]=A[3]+m|0},_doFinalize:function(){var f=this._data,c=f.words,h=8*this._nDataBytes,E=8*f.sigBytes;c[E>>>5]|=128<<24-E%32;var v=s.floor(h/4294967296),A=h;c[15+(E+64>>>9<<4)]=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),c[14+(E+64>>>9<<4)]=16711935&(A<<8|A>>>24)|4278255360&(A<<24|A>>>8),f.sigBytes=4*(c.length+1),this._process();for(var k=this._hash,S=k.words,O=0;O<4;O++){var I=S[O];S[O]=16711935&(I<<8|I>>>24)|4278255360&(I<<24|I>>>8)}return k},clone:function(){var f=u.clone.call(this);return f._hash=this._hash.clone(),f}});function _(f,c,h,E,v,A,k){var S=f+(c&h|~c&E)+v+k;return(S<<A|S>>>32-A)+c}function w(f,c,h,E,v,A,k){var S=f+(c&E|h&~E)+v+k;return(S<<A|S>>>32-A)+c}function F(f,c,h,E,v,A,k){var S=f+(c^h^E)+v+k;return(S<<A|S>>>32-A)+c}function T(f,c,h,E,v,A,k){var S=f+(h^(c|~E))+v+k;return(S<<A|S>>>32-A)+c}o.MD5=u._createHelper(d),o.HmacMD5=u._createHmacHelper(d)}(Math),t.MD5)}),te(function(n,e){var t,s,o;n.exports=(s=(t=Re).lib.Base,o=t.enc.Utf8,void(t.algo.HMAC=s.extend({init:function(i,r){i=this._hasher=new i.init,typeof r=="string"&&(r=o.parse(r));var u=i.blockSize,l=4*u;r.sigBytes>l&&(r=i.finalize(r)),r.clamp();for(var a=this._oKey=r.clone(),d=this._iKey=r.clone(),_=a.words,w=d.words,F=0;F<u;F++)_[F]^=1549556828,w[F]^=909522486;a.sigBytes=d.sigBytes=l,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var r=this._hasher,u=r.finalize(i);return r.reset(),r.finalize(this._oKey.clone().concat(u))}})))}),te(function(n,e){n.exports=Re.HmacMD5})),ft="FUNCTION",zn="OBJECT",Vn="CLIENT_DB";function nt(n){return Object.prototype.toString.call(n).slice(8,-1).toLowerCase()}function xt(n){return nt(n)==="object"}function Lt(n){return n&&typeof n=="string"?JSON.parse(n):n}var Ut=!1,Bt="app";Lt({}.UNICLOUD_DEBUG);var Jn=Lt('[{"provider":"aliyun","spaceName":"positioning","spaceId":"5260c85d-7565-4ff8-8922-3efa92885a84","clientSecret":"AguDoCV7fAJHQXo/k0FuWQ==","endpoint":"https://api.bspapp.com"}]'),Rt="";try{Rt="__UNI__BA53D3D"}catch(n){}var Ne={};function ie(n,e={}){var t,s;return t=Ne,s=n,Object.prototype.hasOwnProperty.call(t,s)||(Ne[n]=e),Ne[n]}var Nt=["invoke","success","fail","complete"],$=ie("_globalUniCloudInterceptor");function Yn(n,e){$[n]||($[n]={}),xt(e)&&Object.keys(e).forEach(t=>{Nt.indexOf(t)>-1&&function(s,o,i){let r=$[s][o];r||(r=$[s][o]=[]),r.indexOf(i)===-1&&typeof i=="function"&&r.push(i)}(n,t,e[t])})}function Gn(n,e){$[n]||($[n]={}),xt(e)?Object.keys(e).forEach(t=>{Nt.indexOf(t)>-1&&function(s,o,i){let r=$[s][o];if(!r)return;let u=r.indexOf(i);u>-1&&r.splice(u,1)}(n,t,e[t])}):delete $[n]}function j(n,e){return n&&n.length!==0?n.reduce((t,s)=>t.then(()=>s(e)),Promise.resolve()):Promise.resolve()}function M(n,e){return $[n]&&$[n][e]||[]}var qe=ie("_globalUniCloudListener"),K="response",X="needLogin",Se="refreshToken",pt="clientdb",ve="cloudfunction",gt="cloudobject";function ue(n){return qe[n]||(qe[n]=[]),qe[n]}function We(n,e){let t=ue(n);t.includes(e)||t.push(e)}function ze(n,e){let t=ue(n),s=t.indexOf(e);s!==-1&&t.splice(s,1)}function B(n,e){let t=ue(n);for(let s=0;s<t.length;s++)(0,t[s])(e)}function qt(n,e){return e?function(t){let s=!1;e==="callFunction"&&(s=(t&&t.type||ft)!==ft);let o=e==="callFunction"&&!s,i;i=this.isReady?Promise.resolve():this.initUniCloud,t=t||{};let r=i.then(()=>s?Promise.resolve():j(M(e,"invoke"),t)).then(()=>n.call(this,t)).then(u=>s?Promise.resolve(u):j(M(e,"success"),u).then(()=>j(M(e,"complete"),u)).then(()=>(o&&B(K,{type:ve,content:u}),Promise.resolve(u))),u=>s?Promise.reject(u):j(M(e,"fail"),u).then(()=>j(M(e,"complete"),u)).then(()=>(B(K,{type:ve,content:u}),Promise.reject(u))));if(!(t.success||t.fail||t.complete))return r;r.then(u=>{t.success&&t.success(u),t.complete&&t.complete(u),o&&B(K,{type:ve,content:u})},u=>{t.fail&&t.fail(u),t.complete&&t.complete(u),o&&B(K,{type:ve,content:u})})}:function(t){if(!((t=t||{}).success||t.fail||t.complete))return n.call(this,t);n.call(this,t).then(s=>{t.success&&t.success(s),t.complete&&t.complete(s)},s=>{t.fail&&t.fail(s),t.complete&&t.complete(s)})}}var P=class extends Error{constructor(e){super(e.message),this.errMsg=e.message||"",this.errCode=this.code=e.code||"SYSTEM_ERROR",this.requestId=e.requestId}};function Qn(){let n;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;let{scene:e,channel:t}=uni.getLaunchOptionsSync();n=e||t}}catch(e){}return n}var Ee;function jt(){let n=uni.getLocale&&uni.getLocale()||"en";if(Ee)return oe(x({},Ee),{locale:n,LOCALE:n});let e=uni.getSystemInfoSync(),{deviceId:t,platform:s,osName:o,uniPlatform:i,appId:r}=e,u=["pixelRatio","brand","model","system","language","version","platform","host","SDKVersion","swanNativeVersion","app","AppPlatform","fontSizeSettin"];for(let l=0;l<u.length;l++)delete e[u[l]];return Ee=x({PLATFORM:i||Bt,OS:o||s,APPID:r||Rt,DEVICEID:t,channel:Qn()},e),oe(x({},Ee),{locale:n,LOCALE:n})}var Te={sign:function(n,e){let t="";return Object.keys(n).sort().forEach(function(s){n[s]&&(t=t+"&"+s+"="+n[s])}),t=t.slice(1),Wn(t,e).toString()},wrappedRequest:function(n,e){return new Promise((t,s)=>{e(Object.assign(n,{complete(o){o||(o={});let i=o.data&&o.data.header&&o.data.header["x-serverless-request-id"]||o.header&&o.header["request-id"];if(!o.statusCode||o.statusCode>=400)return s(new P({code:"SYS_ERR",message:o.errMsg||"request:fail",requestId:i}));let r=o.data;if(r.error)return s(new P({code:r.error.code,message:r.error.message,requestId:i}));r.result=r.data,r.requestId=i,delete r.data,t(r)}}))})}},R={request:n=>uni.request(n),uploadFile:n=>uni.uploadFile(n),setStorageSync:(n,e)=>uni.setStorageSync(n,e),getStorageSync:n=>uni.getStorageSync(n),removeStorageSync:n=>uni.removeStorageSync(n),clearStorageSync:()=>uni.clearStorageSync()},mt={"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},{t:Xn}=jn({"zh-Hans":{"uniCloud.init.paramRequired":"\u7F3A\u5C11\u53C2\u6570\uFF1A{param}","uniCloud.uploadFile.fileError":"filePath\u5E94\u4E3AFile\u5BF9\u8C61"},"zh-Hant":{"uniCloud.init.paramRequired":"\u7F3A\u5C11\u53C2\u6570\uFF1A{param}","uniCloud.uploadFile.fileError":"filePath\u5E94\u4E3AFile\u5BF9\u8C61"},en:mt,fr:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},es:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},ja:mt},"zh-Hans"),Mt=class{constructor(n){["spaceId","clientSecret"].forEach(e=>{if(!Object.prototype.hasOwnProperty.call(n,e))throw new Error(Xn("uniCloud.init.paramRequired",{param:e}))}),this.config=Object.assign({},{endpoint:"https://api.bspapp.com"},n),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=R,this._getAccessTokenPromise=null,this._getAccessTokenPromiseStatus=null}get hasAccessToken(){return!!this.accessToken}setAccessToken(n){this.accessToken=n}requestWrapped(n){return Te.wrappedRequest(n,this.adapter.request)}requestAuth(n){return this.requestWrapped(n)}request(n,e){return Promise.resolve().then(()=>this.hasAccessToken?e?this.requestWrapped(n):this.requestWrapped(n).catch(t=>new Promise((s,o)=>{!t||t.code!=="GATEWAY_INVALID_TOKEN"&&t.code!=="InvalidParameter.InvalidToken"?o(t):s()}).then(()=>this.getAccessToken()).then(()=>{let s=this.rebuildRequest(n);return this.request(s,!0)})):this.getAccessToken().then(()=>{let t=this.rebuildRequest(n);return this.request(t,!0)}))}rebuildRequest(n){let e=Object.assign({},n);return e.data.token=this.accessToken,e.header["x-basement-token"]=this.accessToken,e.header["x-serverless-sign"]=Te.sign(e.data,this.config.clientSecret),e}setupRequest(n,e){let t=Object.assign({},n,{spaceId:this.config.spaceId,timestamp:Date.now()}),s={"Content-Type":"application/json"};return e!=="auth"&&(t.token=this.accessToken,s["x-basement-token"]=this.accessToken),s["x-serverless-sign"]=Te.sign(t,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:s}}getAccessToken(){return this._getAccessTokenPromiseStatus==="pending"?this._getAccessTokenPromise:(this._getAccessTokenPromiseStatus="pending",this._getAccessTokenPromise=this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then(n=>new Promise((e,t)=>{n.result&&n.result.accessToken?(this.setAccessToken(n.result.accessToken),this._getAccessTokenPromiseStatus="fulfilled",e(this.accessToken)):(this._getAccessTokenPromiseStatus="rejected",t(new P({code:"AUTH_FAILED",message:"\u83B7\u53D6accessToken\u5931\u8D25"})))}),n=>(this._getAccessTokenPromiseStatus="rejected",Promise.reject(n))),this._getAccessTokenPromise)}authorize(){this.getAccessToken()}callFunction(n){let e={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:n.name,functionArgs:n.data||{}})};return this.request(this.setupRequest(e))}getOSSUploadOptionsFromPath(n){let e={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(n)};return this.request(this.setupRequest(e))}uploadFileToOSS({url:n,formData:e,name:t,filePath:s,fileType:o,onUploadProgress:i}){return new Promise((r,u)=>{let l=this.adapter.uploadFile({url:n,formData:e,name:t,filePath:s,fileType:o,header:{"X-OSS-server-side-encrpytion":"AES256"},success(a){a&&a.statusCode<400?r(a):u(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(a){u(new P({code:a.code||"UPLOAD_FAILED",message:a.message||a.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof i=="function"&&l&&typeof l.onProgressUpdate=="function"&&l.onProgressUpdate(a=>{i({loaded:a.totalBytesSent,total:a.totalBytesExpectedToSend})})})}reportOSSUpload(n){let e={method:"serverless.file.resource.report",params:JSON.stringify(n)};return this.request(this.setupRequest(e))}uploadFile({filePath:n,cloudPath:e,fileType:t="image",onUploadProgress:s,config:o}){if(nt(e)!=="string")throw new P({code:"INVALID_PARAM",message:"cloudPath\u5FC5\u987B\u4E3A\u5B57\u7B26\u4E32\u7C7B\u578B"});if(!(e=e.trim()))throw new P({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});if(/:\/\//.test(e))throw new P({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u5408\u6CD5"});let i=o&&o.envType||this.config.envType,r,u;return this.getOSSUploadOptionsFromPath({env:i,filename:e}).then(l=>{let a=l.result;r=a.id,u="https://"+a.cdnDomain+"/"+a.ossPath;let d={url:"https://"+a.host,formData:{"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:a.accessKeyId,Signature:a.signature,host:a.host,id:r,key:a.ossPath,policy:a.policy,success_action_status:200},fileName:"file",name:"file",filePath:n,fileType:t};return this.uploadFileToOSS(Object.assign({},d,{onUploadProgress:s}))}).then(()=>this.reportOSSUpload({id:r})).then(l=>new Promise((a,d)=>{l.success?a({success:!0,filePath:n,fileID:u}):d(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}))}deleteFile({fileList:n}){let e={method:"serverless.file.resource.delete",params:JSON.stringify({id:n[0]})};return this.request(this.setupRequest(e))}getTempFileURL({fileList:n}={}){return new Promise((e,t)=>{Array.isArray(n)&&n.length!==0||t(new P({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"})),e({fileList:n.map(s=>({fileID:s,tempFileURL:s}))})})}},Zn={init(n){let e=new Mt(n),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}},es=typeof location!="undefined"&&location.protocol==="http:"?"http:":"https:",yt;(function(n){n.local="local",n.none="none",n.session="session"})(yt||(yt={}));var ts=function(){},ce=()=>{let n;if(!Promise){n=()=>{},n.promise={};let t=()=>{throw new P({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(n.promise,"then",{get:t}),Object.defineProperty(n.promise,"catch",{get:t}),n}let e=new Promise((t,s)=>{n=(o,i)=>o?s(o):t(i)});return n.promise=e,n};function ns(n){return n===void 0}function ss(n){return Object.prototype.toString.call(n)==="[object Null]"}var _t;function os(n){let e=(t=n,Object.prototype.toString.call(t)==="[object Array]"?n:[n]);var t;for(let s of e){let{isMatch:o,genAdapter:i,runtime:r}=s;if(o())return{adapter:i(),runtime:r}}}(function(n){n.WEB="web",n.WX_MP="wx_mp"})(_t||(_t={}));var L={adapter:null,runtime:void 0},is=["anonymousUuidKey"],ne=class extends ts{constructor(){super(),L.adapter.root.tcbObject||(L.adapter.root.tcbObject={})}setItem(e,t){L.adapter.root.tcbObject[e]=t}getItem(e){return L.adapter.root.tcbObject[e]}removeItem(e){delete L.adapter.root.tcbObject[e]}clear(){delete L.adapter.root.tcbObject}};function At(n,e){switch(n){case"local":return e.localStorage||new ne;case"none":return new ne;default:return e.sessionStorage||new ne}}var Pe=class{constructor(e){if(!this._storage){this._persistence=L.adapter.primaryStorage||e.persistence,this._storage=At(this._persistence,L.adapter);let t=`access_token_${e.env}`,s=`access_token_expire_${e.env}`,o=`refresh_token_${e.env}`,i=`anonymous_uuid_${e.env}`,r=`login_type_${e.env}`,u=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:o,anonymousUuidKey:i,loginTypeKey:r,userInfoKey:u}}}updatePersistence(e){if(e===this._persistence)return;let t=this._persistence==="local";this._persistence=e;let s=At(e,L.adapter);for(let o in this.keys){let i=this.keys[o];if(t&&is.includes(o))continue;let r=this._storage.getItem(i);ns(r)||ss(r)||(s.setItem(i,r),this._storage.removeItem(i))}this._storage=s}setStore(e,t,s){if(!this._storage)return;let o={version:s||"localCachev1",content:t},i=JSON.stringify(o);try{this._storage.setItem(e,i)}catch(r){throw r}}getStore(e,t){try{if(!this._storage)return}catch(o){return""}t=t||"localCachev1";let s=this._storage.getItem(e);return s&&s.indexOf(t)>=0?JSON.parse(s).content:""}removeStore(e){this._storage.removeItem(e)}},$t={},Kt={};function le(n){return $t[n]}var Ce=class{constructor(e,t){this.data=t||null,this.name=e}},Ve=class extends Ce{constructor(e,t){super("error",{error:e,data:t}),this.error=e}},st=new class{constructor(){this._listeners={}}on(n,e){return function(t,s,o){o[t]=o[t]||[],o[t].push(s)}(n,e,this._listeners),this}off(n,e){return function(t,s,o){if(o&&o[t]){let i=o[t].indexOf(s);i!==-1&&o[t].splice(i,1)}}(n,e,this._listeners),this}fire(n,e){if(n instanceof Ve)return console.error(n.error),this;let t=typeof n=="string"?new Ce(n,e||{}):n,s=t.name;if(this._listens(s)){t.target=this;let o=this._listeners[s]?[...this._listeners[s]]:[];for(let i of o)i.call(this,t)}return this}_listens(n){return this._listeners[n]&&this._listeners[n].length>0}};function z(n,e){st.on(n,e)}function U(n,e={}){st.fire(n,e)}function rs(n,e){st.off(n,e)}var Z="loginStateChanged",Ht="loginStateExpire",V="loginTypeChanged",Je="anonymousConverted",Wt="refreshAccessToken",b;(function(n){n.ANONYMOUS="ANONYMOUS",n.WECHAT="WECHAT",n.WECHAT_PUBLIC="WECHAT-PUBLIC",n.WECHAT_OPEN="WECHAT-OPEN",n.CUSTOM="CUSTOM",n.EMAIL="EMAIL",n.USERNAME="USERNAME",n.NULL="NULL"})(b||(b={}));var wt=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],as={"X-SDK-Version":"1.3.5"};function je(n,e,t){let s=n[e];n[e]=function(o){let i={},r={};t.forEach(l=>{let{data:a,headers:d}=l.call(n,o);Object.assign(i,a),Object.assign(r,d)});let u=o.data;return u&&(()=>{var l;if(l=u,Object.prototype.toString.call(l)!=="[object FormData]")o.data=x(x({},u),i);else for(let a in i)u.append(a,i[a])})(),o.headers=x(x({},o.headers||{}),r),s.call(n,o)}}function Me(){let n=Math.random().toString(16).slice(2);return{data:{seqId:n},headers:oe(x({},as),{"x-seqid":n})}}var Ye=class{constructor(e={}){var t;this.config=e,this._reqClass=new L.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`\u8BF7\u6C42\u5728${this.config.timeout/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`,restrictedMethods:["post"]}),this._cache=le(this.config.env),this._localCache=(t=this.config.env,Kt[t]),je(this._reqClass,"post",[Me]),je(this._reqClass,"upload",[Me]),je(this._reqClass,"download",[Me])}post(e){return C(this,null,function*(){return yield this._reqClass.post(e)})}upload(e){return C(this,null,function*(){return yield this._reqClass.upload(e)})}download(e){return C(this,null,function*(){return yield this._reqClass.download(e)})}refreshAccessToken(){return C(this,null,function*(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=yield this._refreshAccessTokenPromise}catch(s){t=s}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e})}_refreshAccessToken(){return C(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:s,loginTypeKey:o,anonymousUuidKey:i}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let r=this._cache.getStore(s);if(!r)throw new P({message:"\u672A\u767B\u5F55CloudBase"});let u={refresh_token:r},l=yield this.request("auth.fetchAccessTokenWithRefreshToken",u);if(l.data.code){let{code:a}=l.data;if(a==="SIGN_PARAM_INVALID"||a==="REFRESH_TOKEN_EXPIRED"||a==="INVALID_REFRESH_TOKEN"){if(this._cache.getStore(o)===b.ANONYMOUS&&a==="INVALID_REFRESH_TOKEN"){let d=this._cache.getStore(i),_=this._cache.getStore(s),w=yield this.send("auth.signInAnonymously",{anonymous_uuid:d,refresh_token:_});return this.setRefreshToken(w.refresh_token),this._refreshAccessToken()}U(Ht),this._cache.removeStore(s)}throw new P({code:l.data.code,message:`\u5237\u65B0access token\u5931\u8D25\uFF1A${l.data.code}`})}if(l.data.access_token)return U(Wt),this._cache.setStore(e,l.data.access_token),this._cache.setStore(t,l.data.access_token_expire+Date.now()),{accessToken:l.data.access_token,accessTokenExpire:l.data.access_token_expire};l.data.refresh_token&&(this._cache.removeStore(s),this._cache.setStore(s,l.data.refresh_token),this._refreshAccessToken())})}getAccessToken(){return C(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:s}=this._cache.keys;if(!this._cache.getStore(s))throw new P({message:"refresh token\u4E0D\u5B58\u5728\uFF0C\u767B\u5F55\u72B6\u6001\u5F02\u5E38"});let o=this._cache.getStore(e),i=this._cache.getStore(t),r=!0;return this._shouldRefreshAccessTokenHook&&!(yield this._shouldRefreshAccessTokenHook(o,i))&&(r=!1),(!o||!i||i<Date.now())&&r?this.refreshAccessToken():{accessToken:o,accessTokenExpire:i}})}request(e,t,s){return C(this,null,function*(){let o=`x-tcb-trace_${this.config.env}`,i="application/x-www-form-urlencoded",r=x({action:e,env:this.config.env,dataVersion:"2019-08-16"},t);if(wt.indexOf(e)===-1){let{refreshTokenKey:h}=this._cache.keys;this._cache.getStore(h)&&(r.access_token=(yield this.getAccessToken()).accessToken)}let u;if(e==="storage.uploadFile"){u=new FormData;for(let h in u)u.hasOwnProperty(h)&&u[h]!==void 0&&u.append(h,r[h]);i="multipart/form-data"}else{i="application/json",u={};for(let h in r)r[h]!==void 0&&(u[h]=r[h])}let l={headers:{"content-type":i}};s&&s.onUploadProgress&&(l.onUploadProgress=s.onUploadProgress);let a=this._localCache.getStore(o);a&&(l.headers["X-TCB-Trace"]=a);let{parse:d,inQuery:_,search:w}=t,F={env:this.config.env};d&&(F.parse=!0),_&&(F=x(x({},_),F));let T=function(h,E,v={}){let A=/\?/.test(E),k="";for(let S in v)k===""?!A&&(E+="?"):k+="&",k+=`${S}=${encodeURIComponent(v[S])}`;return/^http(s)?\:\/\//.test(E+=k)?E:`${h}${E}`}(es,"//tcb-api.tencentcloudapi.com/web",F);w&&(T+=w);let f=yield this.post(x({url:T,data:u},l)),c=f.header&&f.header["x-tcb-trace"];if(c&&this._localCache.setStore(o,c),Number(f.status)!==200&&Number(f.statusCode)!==200||!f.data)throw new P({code:"NETWORK_ERROR",message:"network request error"});return f})}send(s){return C(this,arguments,function*(e,t={}){let o=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(o.data.code==="ACCESS_TOKEN_EXPIRED"&&wt.indexOf(e)===-1){yield this.refreshAccessToken();let i=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(i.data.code)throw new P({code:i.data.code,message:i.data.message});return i.data}if(o.data.code)throw new P({code:o.data.code,message:o.data.message});return o.data})}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(s),this._cache.setStore(o,e)}},zt={};function W(n){return zt[n]}var ee=class{constructor(e){this.config=e,this._cache=le(e.env),this._request=W(e.env)}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(s),this._cache.setStore(o,e)}setAccessToken(e,t){let{accessTokenKey:s,accessTokenExpireKey:o}=this._cache.keys;this._cache.setStore(s,e),this._cache.setStore(o,t)}refreshUserInfo(){return C(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}},Ge=class{constructor(e){if(!e)throw new P({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=le(this._envId),this._request=W(this._envId),this.setUserInfo()}linkWithTicket(e){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}getLinkedUidList(){return C(this,null,function*(){let{data:e}=yield this._request.send("auth.getLinkedUidList",{}),t=!1,{users:s}=e;return s.forEach(o=>{o.wxOpenId&&o.wxPublicId&&(t=!0)}),{users:s,hasPrimaryUid:t}})}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}update(e){return C(this,null,function*(){let{nickName:t,gender:s,avatarUrl:o,province:i,country:r,city:u}=e,{data:l}=yield this._request.send("auth.updateUserInfo",{nickName:t,gender:s,avatarUrl:o,province:i,country:r,city:u});this.setLocalUserInfo(l)})}refresh(){return C(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setUserInfo(){let{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach(s=>{this[s]=t[s]}),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}},G=class{constructor(e){if(!e)throw new P({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=le(e);let{refreshTokenKey:t,accessTokenKey:s,accessTokenExpireKey:o}=this._cache.keys,i=this._cache.getStore(t),r=this._cache.getStore(s),u=this._cache.getStore(o);this.credential={refreshToken:i,accessToken:r,accessTokenExpire:u},this.user=new Ge(e)}get isAnonymousAuth(){return this.loginType===b.ANONYMOUS}get isCustomAuth(){return this.loginType===b.CUSTOM}get isWeixinAuth(){return this.loginType===b.WECHAT||this.loginType===b.WECHAT_OPEN||this.loginType===b.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}},se=class extends ee{signIn(){return C(this,null,function*(){this._cache.updatePersistence("local");let{anonymousUuidKey:e,refreshTokenKey:t}=this._cache.keys,s=this._cache.getStore(e)||void 0,o=this._cache.getStore(t)||void 0,i=yield this._request.send("auth.signInAnonymously",{anonymous_uuid:s,refresh_token:o});if(i.uuid&&i.refresh_token){this._setAnonymousUUID(i.uuid),this.setRefreshToken(i.refresh_token),yield this._request.refreshAccessToken(),U(Z),U(V,{env:this.config.env,loginType:b.ANONYMOUS,persistence:"local"});let r=new G(this.config.env);return yield r.user.refresh(),r}throw new P({message:"\u533F\u540D\u767B\u5F55\u5931\u8D25"})})}linkAndRetrieveDataWithTicket(e){return C(this,null,function*(){let{anonymousUuidKey:t,refreshTokenKey:s}=this._cache.keys,o=this._cache.getStore(t),i=this._cache.getStore(s),r=yield this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:o,refresh_token:i,ticket:e});if(r.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(r.refresh_token),yield this._request.refreshAccessToken(),U(Je,{env:this.config.env}),U(V,{loginType:b.CUSTOM,persistence:"local"}),{credential:{refreshToken:r.refresh_token}};throw new P({message:"\u533F\u540D\u8F6C\u5316\u5931\u8D25"})})}_setAnonymousUUID(e){let{anonymousUuidKey:t,loginTypeKey:s}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(s,b.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}},Ie=class extends ee{signIn(e){return C(this,null,function*(){if(typeof e!="string")throw new P({param:"PARAM_ERROR",message:"ticket must be a string"});let{refreshTokenKey:t}=this._cache.keys,s=yield this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(s.refresh_token)return this.setRefreshToken(s.refresh_token),yield this._request.refreshAccessToken(),U(Z),U(V,{env:this.config.env,loginType:b.CUSTOM,persistence:this.config.persistence}),yield this.refreshUserInfo(),new G(this.config.env);throw new P({message:"\u81EA\u5B9A\u4E49\u767B\u5F55\u5931\u8D25"})})}},De=class extends ee{signIn(e,t){return C(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"email must be a string"});let{refreshTokenKey:s}=this._cache.keys,o=yield this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(s)||""}),{refresh_token:i,access_token:r,access_token_expire:u}=o;if(i)return this.setRefreshToken(i),r&&u?this.setAccessToken(r,u):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),U(Z),U(V,{env:this.config.env,loginType:b.EMAIL,persistence:this.config.persistence}),new G(this.config.env);throw o.code?new P({code:o.code,message:`\u90AE\u7BB1\u767B\u5F55\u5931\u8D25: ${o.message}`}):new P({message:"\u90AE\u7BB1\u767B\u5F55\u5931\u8D25"})})}activate(e){return C(this,null,function*(){return this._request.send("auth.activateEndUserMail",{token:e})})}resetPasswordWithToken(e,t){return C(this,null,function*(){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})})}},Oe=class extends ee{signIn(e,t){return C(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});typeof t!="string"&&(t="",console.warn("password is empty"));let{refreshTokenKey:s}=this._cache.keys,o=yield this._request.send("auth.signIn",{loginType:b.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(s)||""}),{refresh_token:i,access_token_expire:r,access_token:u}=o;if(i)return this.setRefreshToken(i),u&&r?this.setAccessToken(u,r):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),U(Z),U(V,{env:this.config.env,loginType:b.USERNAME,persistence:this.config.persistence}),new G(this.config.env);throw o.code?new P({code:o.code,message:`\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25: ${o.message}`}):new P({message:"\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25"})})}},Qe=class{constructor(e){this.config=e,this._cache=le(e.env),this._request=W(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),z(V,this._onLoginTypeChanged)}get currentUser(){let e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new se(this.config)}customAuthProvider(){return new Ie(this.config)}emailAuthProvider(){return new De(this.config)}usernameAuthProvider(){return new Oe(this.config)}signInAnonymously(){return C(this,null,function*(){return new se(this.config).signIn()})}signInWithEmailAndPassword(e,t){return C(this,null,function*(){return new De(this.config).signIn(e,t)})}signInWithUsernameAndPassword(e,t){return new Oe(this.config).signIn(e,t)}linkAndRetrieveDataWithTicket(e){return C(this,null,function*(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new se(this.config)),z(Je,this._onAnonymousConverted),yield this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)})}signOut(){return C(this,null,function*(){if(this.loginType===b.ANONYMOUS)throw new P({message:"\u533F\u540D\u7528\u6237\u4E0D\u652F\u6301\u767B\u51FA\u64CD\u4F5C"});let{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:s}=this._cache.keys,o=this._cache.getStore(e);if(!o)return;let i=yield this._request.send("auth.logout",{refresh_token:o});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(s),U(Z),U(V,{env:this.config.env,loginType:b.NULL,persistence:this.config.persistence}),i})}signUpWithEmailAndPassword(e,t){return C(this,null,function*(){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})})}sendPasswordResetEmail(e){return C(this,null,function*(){return this._request.send("auth.sendPasswordResetEmail",{email:e})})}onLoginStateChanged(e){z(Z,()=>{let s=this.hasLoginState();e.call(this,s)});let t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){z(Ht,e.bind(this))}onAccessTokenRefreshed(e){z(Wt,e.bind(this))}onAnonymousConverted(e){z(Je,e.bind(this))}onLoginTypeChanged(e){z(V,()=>{let t=this.hasLoginState();e.call(this,t)})}getAccessToken(){return C(this,null,function*(){return{accessToken:(yield this._request.getAccessToken()).accessToken,env:this.config.env}})}hasLoginState(){let{refreshTokenKey:e}=this._cache.keys;return this._cache.getStore(e)?new G(this.config.env):null}isUsernameRegistered(e){return C(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});let{data:t}=yield this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered})}getLoginState(){return Promise.resolve(this.hasLoginState())}signInWithTicket(e){return C(this,null,function*(){return new Ie(this.config).signIn(e)})}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then(e=>e.code?e:oe(x({},e.data),{requestId:e.seqId}))}getAuthHeader(){let{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,s=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+s}}_onAnonymousConverted(e){let{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){let{loginType:t,persistence:s,env:o}=e.data;o===this.config.env&&(this._cache.updatePersistence(s),this._cache.setStore(this._cache.keys.loginTypeKey,t))}},us=function(n,e){e=e||ce();let t=W(this.config.env),{cloudPath:s,filePath:o,onUploadProgress:i,fileType:r="image"}=n;return t.send("storage.getUploadMetadata",{path:s}).then(u=>{let{data:{url:l,authorization:a,token:d,fileId:_,cosFileId:w},requestId:F}=u,T={key:s,signature:a,"x-cos-meta-fileid":w,success_action_status:"201","x-cos-security-token":d};t.upload({url:l,data:T,file:o,name:s,fileType:r,onUploadProgress:i}).then(f=>{f.statusCode===201?e(null,{fileID:_,requestId:F}):e(new P({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${f.data}`}))}).catch(f=>{e(f)})}).catch(u=>{e(u)}),e.promise},cs=function(n,e){e=e||ce();let t=W(this.config.env),{cloudPath:s}=n;return t.send("storage.getUploadMetadata",{path:s}).then(o=>{e(null,o)}).catch(o=>{e(o)}),e.promise},ls=function({fileList:n},e){if(e=e||ce(),!n||!Array.isArray(n))return{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"};for(let s of n)if(!s||typeof s!="string")return{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"};let t={fileid_list:n};return W(this.config.env).send("storage.batchDeleteFile",t).then(s=>{s.code?e(null,s):e(null,{fileList:s.data.delete_list,requestId:s.requestId})}).catch(s=>{e(s)}),e.promise},Vt=function({fileList:n},e){e=e||ce(),n&&Array.isArray(n)||e(null,{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"});let t=[];for(let o of n)typeof o=="object"?(o.hasOwnProperty("fileID")&&o.hasOwnProperty("maxAge")||e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5305\u542BfileID\u548CmaxAge\u7684\u5BF9\u8C61"}),t.push({fileid:o.fileID,max_age:o.maxAge})):typeof o=="string"?t.push({fileid:o}):e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5B57\u7B26\u4E32"});let s={file_list:t};return W(this.config.env).send("storage.batchGetDownloadUrl",s).then(o=>{o.code?e(null,o):e(null,{fileList:o.data.download_list,requestId:o.requestId})}).catch(o=>{e(o)}),e.promise},hs=function(t,s){return C(this,arguments,function*({fileID:n},e){let o=(yield Vt.call(this,{fileList:[{fileID:n,maxAge:600}]})).fileList[0];if(o.code!=="SUCCESS")return e?e(o):new Promise(u=>{u(o)});let i=W(this.config.env),r=o.download_url;if(r=encodeURI(r),!e)return i.download({url:r});e(yield i.download({url:r}))})},ds=function({name:n,data:e,query:t,parse:s,search:o},i){let r=i||ce(),u;try{u=e?JSON.stringify(e):""}catch(a){return Promise.reject(a)}if(!n)return Promise.reject(new P({code:"PARAM_ERROR",message:"\u51FD\u6570\u540D\u4E0D\u80FD\u4E3A\u7A7A"}));let l={inQuery:t,parse:s,search:o,function_name:n,request_data:u};return W(this.config.env).send("functions.invokeFunction",l).then(a=>{if(a.code)r(null,a);else{let d=a.data.response_data;if(s)r(null,{result:d,requestId:a.requestId});else try{d=JSON.parse(a.data.response_data),r(null,{result:d,requestId:a.requestId})}catch(_){r(new P({message:"response data must be json"}))}}return r.promise}).catch(a=>{r(a)}),r.promise},Ft={timeout:15e3,persistence:"session"},vt={},re=class{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(L.adapter||(this.requestClient=new L.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`\u8BF7\u6C42\u5728${(e.timeout||5e3)/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`})),this.config=x(x({},Ft),e),!0){case this.config.timeout>6e5:console.warn("timeout\u5927\u4E8E\u53EF\u914D\u7F6E\u4E0A\u9650[10\u5206\u949F]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0A\u9650\u6570\u503C"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("timeout\u5C0F\u4E8E\u53EF\u914D\u7F6E\u4E0B\u9650[100ms]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0B\u9650\u6570\u503C"),this.config.timeout=100}return new re(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;let t=e||L.adapter.primaryStorage||Ft.persistence;var s;return t!==this.config.persistence&&(this.config.persistence=t),function(o){let{env:i}=o;$t[i]=new Pe(o),Kt[i]=new Pe(oe(x({},o),{persistence:"local"}))}(this.config),s=this.config,zt[s.env]=new Ye(s),this.authObj=new Qe(this.config),this.authObj}on(e,t){return z.apply(this,[e,t])}off(e,t){return rs.apply(this,[e,t])}callFunction(e,t){return ds.apply(this,[e,t])}deleteFile(e,t){return ls.apply(this,[e,t])}getTempFileURL(e,t){return Vt.apply(this,[e,t])}downloadFile(e,t){return hs.apply(this,[e,t])}uploadFile(e,t){return us.apply(this,[e,t])}getUploadMetadata(e,t){return cs.apply(this,[e,t])}registerExtension(e){vt[e.name]=e}invokeExtension(e,t){return C(this,null,function*(){let s=vt[e];if(!s)throw new P({message:`\u6269\u5C55${e} \u5FC5\u987B\u5148\u6CE8\u518C`});return yield s.invoke(t,this)})}useAdapters(e){let{adapter:t,runtime:s}=os(e)||{};t&&(L.adapter=t),s&&(L.runtime=s)}},Jt=new re;function Et(n,e,t){t===void 0&&(t={});var s=/\?/.test(e),o="";for(var i in t)o===""?!s&&(e+="?"):o+="&",o+=i+"="+encodeURIComponent(t[i]);return/^http(s)?:\/\//.test(e+=o)?e:""+n+e}var Xe=class{post(e){let{url:t,data:s,headers:o}=e;return new Promise((i,r)=>{R.request({url:Et("https:",t),data:s,method:"POST",header:o,success(u){i(u)},fail(u){r(u)}})})}upload(e){return new Promise((t,s)=>{let{url:o,file:i,data:r,headers:u,fileType:l}=e,a=R.uploadFile({url:Et("https:",o),name:"file",formData:Object.assign({},r),filePath:i,fileType:l,header:u,success(d){let _={statusCode:d.statusCode,data:d.data||{}};d.statusCode===200&&r.success_action_status&&(_.statusCode=parseInt(r.success_action_status,10)),t(_)},fail(d){s(new Error(d.errMsg||"uploadFile:fail"))}});typeof e.onUploadProgress=="function"&&a&&typeof a.onProgressUpdate=="function"&&a.onProgressUpdate(d=>{e.onUploadProgress({loaded:d.totalBytesSent,total:d.totalBytesExpectedToSend})})})}},fs={setItem(n,e){R.setStorageSync(n,e)},getItem:n=>R.getStorageSync(n),removeItem(n){R.removeStorageSync(n)},clear(){R.clearStorageSync()}},ps={genAdapter:function(){return{root:{},reqClass:Xe,localStorage:fs,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};Jt.useAdapters(ps);var ot=Jt,gs=ot.init;ot.init=function(n){n.env=n.spaceId;let e=gs.call(this,n);e.config.provider="tencent",e.config.spaceId=n.spaceId;let t=e.auth;return e.auth=function(s){let o=t.call(this,s);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach(i=>{o[i]=qt(o[i]).bind(o)}),o},e.customAuth=e.auth,e};var ms=ot;function Yt(n){return n&&Yt(n.__v_raw)||n}function Le(){return{token:R.getStorageSync("uni_id_token")||R.getStorageSync("uniIdToken"),tokenExpired:R.getStorageSync("uni_id_token_expired")}}function Gt({token:n,tokenExpired:e}={}){n&&R.setStorageSync("uni_id_token",n),e&&R.setStorageSync("uni_id_token_expired",e)}var ys=class extends Mt{getAccessToken(){return new Promise((n,e)=>{let t="Anonymous_Access_token";this.setAccessToken(t),n(t)})}setupRequest(n,e){let t=Object.assign({},n,{spaceId:this.config.spaceId,timestamp:Date.now()}),s={"Content-Type":"application/json"};e!=="auth"&&(t.token=this.accessToken,s["x-basement-token"]=this.accessToken),s["x-serverless-sign"]=Te.sign(t,this.config.clientSecret);let o=jt();s["x-client-info"]=JSON.stringify(o);let{token:i}=Le();return s["x-client-token"]=i,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(s))}}uploadFileToOSS({url:n,formData:e,name:t,filePath:s,fileType:o,onUploadProgress:i}){return new Promise((r,u)=>{let l=this.adapter.uploadFile({url:n,formData:e,name:t,filePath:s,fileType:o,success(a){a&&a.statusCode<400?r(a):u(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(a){u(new P({code:a.code||"UPLOAD_FAILED",message:a.message||a.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof i=="function"&&l&&typeof l.onProgressUpdate=="function"&&l.onProgressUpdate(a=>{i({loaded:a.totalBytesSent,total:a.totalBytesExpectedToSend})})})}uploadFile({filePath:n,cloudPath:e,fileType:t="image",onUploadProgress:s}){if(!e)throw new P({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});let o;return this.getOSSUploadOptionsFromPath({cloudPath:e}).then(i=>{let{url:r,formData:u,name:l}=i.result;o=i.result.fileUrl;let a={url:r,formData:u,name:l,filePath:n,fileType:t};return this.uploadFileToOSS(Object.assign({},a,{onUploadProgress:s}))}).then(()=>this.reportOSSUpload({cloudPath:e})).then(i=>new Promise((r,u)=>{i.success?r({success:!0,filePath:n,fileID:o}):u(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}))}deleteFile({fileList:n}){let e={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:n})};return this.request(this.setupRequest(e))}getTempFileURL({fileList:n}={}){let e={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:n})};return this.request(this.setupRequest(e))}},_s={init(n){let e=new ys(n),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}};function As({data:n}){let e;e=jt();let t=JSON.parse(JSON.stringify(n||{}));if(Object.assign(t,{clientInfo:e}),!t.uniIdToken){let{token:s}=Le();s&&(t.uniIdToken=s)}return t}var ws=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"\uFF0C\u4E91\u51FD\u6570[{functionName}]\u5728\u4E91\u7AEF\u4E0D\u5B58\u5728\uFF0C\u8BF7\u68C0\u67E5\u6B64\u4E91\u51FD\u6570\u540D\u79F0\u662F\u5426\u6B63\u786E\u4EE5\u53CA\u8BE5\u4E91\u51FD\u6570\u662F\u5426\u5DF2\u4E0A\u4F20\u5230\u670D\u52A1\u7A7A\u95F4",mode:"append"}],Qt=/[\\^$.*+?()[\]{}|]/g,Fs=RegExp(Qt.source);function kt(n,e,t){return n.replace(new RegExp((s=e)&&Fs.test(s)?s.replace(Qt,"\\$&"):s,"g"),t);var s}function Tt({functionName:n,result:e,logPvd:t}){if(this.config.useDebugFunction&&e&&e.requestId){let s=JSON.stringify({spaceId:this.config.spaceId,functionName:n,requestId:e.requestId});console.log(`[${t}-request]${s}[/${t}-request]`)}}function vs(n){let e=n.callFunction,t=function(s){let o=s.name;s.data=As.call(n,{data:s.data});let i={aliyun:"aliyun",tencent:"tcb",tcb:"tcb"}[this.config.provider];return e.call(this,s).then(r=>(r.errCode=0,Tt.call(this,{functionName:o,result:r,logPvd:i}),Promise.resolve(r)),r=>(Tt.call(this,{functionName:o,result:r,logPvd:i}),r&&r.message&&(r.message=function({message:u="",extraInfo:l={},formatter:a=[]}={}){for(let d=0;d<a.length;d++){let{rule:_,content:w,mode:F}=a[d],T=u.match(_);if(!T)continue;let f=w;for(let c=1;c<T.length;c++)f=kt(f,`{$${c}}`,T[c]);for(let c in l)f=kt(f,`{${c}}`,l[c]);return F==="replace"?f:u+f}return u}({message:`[${s.name}]: ${r.message}`,formatter:ws,extraInfo:{functionName:o}})),Promise.reject(r)))};n.callFunction=function(s){let o;return o=t.call(this,s),Object.defineProperty(o,"result",{get:()=>(console.warn("\u5F53\u524D\u8FD4\u56DE\u7ED3\u679C\u4E3APromise\u7C7B\u578B\uFF0C\u4E0D\u53EF\u76F4\u63A5\u8BBF\u95EE\u5176result\u5C5E\u6027\uFF0C\u8BE6\u60C5\u8BF7\u53C2\u8003\uFF1Ahttps://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),o}}var Xt=Symbol("CLIENT_DB_INTERNAL");function be(n,e){return n.then="DoNotReturnProxyWithAFunctionNamedThen",n._internalType=Xt,n.__v_raw=void 0,new Proxy(n,{get(t,s,o){if(s==="_uniClient")return null;if(s in t||typeof s!="string"){let i=t[s];return typeof i=="function"?i.bind(t):i}return e.get(t,s,o)}})}function St(n){return{on:(e,t)=>{n[e]=n[e]||[],n[e].indexOf(t)>-1||n[e].push(t)},off:(e,t)=>{n[e]=n[e]||[];let s=n[e].indexOf(t);s!==-1&&n[e].splice(s,1)}}}var Es=["db.Geo","db.command","command.aggregate"];function Zt(n,e){return Es.indexOf(`${n}.${e}`)>-1}function Y(n){switch(nt(n=Yt(n))){case"array":return n.map(e=>Y(e));case"object":return n._internalType===Xt||Object.keys(n).forEach(e=>{n[e]=Y(n[e])}),n;case"regexp":return{$regexp:{source:n.source,flags:n.flags}};case"date":return{$date:n.toISOString()};default:return n}}var Ze=class{constructor(e,t,s){this.content=e,this.prevStage=t||null,this.udb=null,this._database=s}toJSON(){let e=this,t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map(s=>({$method:s.$method,$param:Y(s.$param)}))}}getAction(){let e=this.toJSON().$db.find(t=>t.$method==="action");return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter(e=>e.$method!=="action")}}get useAggregate(){let e=this,t=!1;for(;e.prevStage;){e=e.prevStage;let s=e.content.$method;if(s==="aggregate"||s==="pipeline"){t=!0;break}}return t}get count(){if(!this.useAggregate)return function(){return this._send("count",Array.from(arguments))};let e=this;return function(){return ae({$method:"count",$param:Y(Array.from(arguments))},e,this._database)}}get(){return this._send("get",Array.from(arguments))}add(){return this._send("add",Array.from(arguments))}remove(){return this._send("remove",Array.from(arguments))}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}set(){throw new Error("clientDB\u7981\u6B62\u4F7F\u7528set\u65B9\u6CD5")}_send(e,t){let s=this.getAction(),o=this.getCommand();return o.$db.push({$method:e,$param:Y(t)}),this._database._callCloudFunction({action:s,command:o})}};function ae(n,e,t){return be(new Ze(n,e,t),{get(s,o){let i="db";return s&&s.content&&(i=s.content.$method),Zt(i,o)?ae({$method:o},s,t):function(){return ae({$method:o,$param:Y(Array.from(arguments))},s,t)}}})}function $e({path:n,method:e}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...n.map(t=>({$method:t})),{$method:e,$param:this.param}]}}}}var et=class extends class{constructor({uniClient:e={}}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e.isDefault&&(this._dbCallBacks=ie("_globalUniCloudDatabaseCallback")),this.auth=St(this._authCallBacks),Object.assign(this,St(this._dbCallBacks)),this.env=be({},{get:(t,s)=>({$env:s})}),this.Geo=be({},{get:(t,s)=>$e({path:["Geo"],method:s})}),this.serverDate=$e({path:[],method:"serverDate"}),this.RegExp=$e({path:[],method:"RegExp"})}getCloudEnv(e){if(typeof e!="string"||!e.trim())throw new Error("getCloudEnv\u53C2\u6570\u9519\u8BEF");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){let s=this._dbCallBacks;s[e]&&s[e].forEach(o=>{o(...t)})}_callbackAuth(e,t){let s=this._authCallBacks;s[e]&&s[e].forEach(o=>{o(...t)})}multiSend(){let e=Array.from(arguments),t=e.map(s=>{let o=s.getAction(),i=s.getCommand();if(i.$db[i.$db.length-1].$method!=="getTemp")throw new Error("multiSend\u53EA\u652F\u6301\u5B50\u547D\u4EE4\u5185\u4F7F\u7528getTemp");return{action:o,command:i}});return this._callCloudFunction({multiCommand:t,queryList:e})}}{_callCloudFunction({action:e,command:t,multiCommand:s,queryList:o}){function i(d,_){if(s&&o)for(let w=0;w<o.length;w++){let F=o[w];F.udb&&typeof F.udb.setResult=="function"&&(_?F.udb.setResult(_):F.udb.setResult(d.result.dataList[w]))}}let r=this;function u(d){return r._callback("error",[d]),j(M("database","fail"),d).then(()=>j(M("database","complete"),d)).then(()=>(i(null,d),B(K,{type:pt,content:d}),Promise.reject(d)))}let l=j(M("database","invoke")),a=this._uniClient;return l.then(()=>a.callFunction({name:"DCloud-clientDB",type:Vn,data:{action:e,command:t,multiCommand:s}})).then(d=>{let{code:_,message:w,token:F,tokenExpired:T,systemInfo:f=[]}=d.result;if(f)for(let h=0;h<f.length;h++){let{level:E,message:v,detail:A}=f[h],k=console[E]||console.log,S="[System Info]"+v;A&&(S=`${S}
\u8BE6\u7EC6\u4FE1\u606F\uFF1A${A}`),k(S)}if(_)return u(new P({code:_,message:w,requestId:d.requestId}));d.result.errCode=d.result.code,d.result.errMsg=d.result.message,F&&T&&(Gt({token:F,tokenExpired:T}),this._callbackAuth("refreshToken",[{token:F,tokenExpired:T}]),this._callback("refreshToken",[{token:F,tokenExpired:T}]),B(Se,{token:F,tokenExpired:T}));let c=[{prop:"affectedDocs",tips:"affectedDocs\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528inserted/deleted/updated/data.length\u66FF\u4EE3"},{prop:"code",tips:"code\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errCode\u66FF\u4EE3"},{prop:"message",tips:"message\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errMsg\u66FF\u4EE3"}];for(let h=0;h<c.length;h++){let{prop:E,tips:v}=c[h];if(E in d.result){let A=d.result[E];Object.defineProperty(d.result,E,{get:()=>(console.warn(v),A)})}}return function(h){return j(M("database","success"),h).then(()=>j(M("database","complete"),h)).then(()=>(i(h,null),B(K,{type:pt,content:h}),Promise.resolve(h)))}(d)},d=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(d.message)&&console.warn("clientDB\u672A\u521D\u59CB\u5316\uFF0C\u8BF7\u5728web\u63A7\u5236\u53F0\u4FDD\u5B58\u4E00\u6B21schema\u4EE5\u5F00\u542FclientDB"),u(new P({code:d.code||"SYSTEM_ERROR",message:d.message,requestId:d.requestId}))))}};function ks(n){n.database=function(e){if(e&&Object.keys(e).length>0)return n.init(e).database();if(this._database)return this._database;let t=function(s,o={}){return be(new s(o),{get:(i,r)=>Zt("db",r)?ae({$method:r},null,i):function(){return ae({$method:r,$param:Y(Array.from(arguments))},null,i)}})}(et,{uniClient:n});return this._database=t,t}}var J="token\u65E0\u6548\uFF0C\u8DF3\u8F6C\u767B\u5F55\u9875\u9762",en="token\u8FC7\u671F\uFF0C\u8DF3\u8F6C\u767B\u5F55\u9875\u9762",Ts={TOKEN_INVALID_TOKEN_EXPIRED:en,TOKEN_INVALID_INVALID_CLIENTID:J,TOKEN_INVALID:J,TOKEN_INVALID_WRONG_TOKEN:J,TOKEN_INVALID_ANONYMOUS_USER:J},tt={"uni-id-token-expired":en,"uni-id-check-token-failed":J,"uni-id-token-not-exist":J,"uni-id-check-device-feature-failed":J};function Pt(n,e){let t="";return t=n?`${n}/${e}`:e,t.replace(/^\//,"")}function Ct(n=[],e=""){let t=[],s=[];return n.forEach(o=>{o.needLogin===!0?t.push(Pt(e,o.path)):o.needLogin===!1&&s.push(Pt(e,o.path))}),{needLoginPage:t,notNeedLoginPage:s}}var Ss=!!bt.uniIdRouter,{loginPage:xe,routerNeedLogin:Ps,resToLogin:Cs,needLoginPage:Is,notNeedLoginPage:Ds}=function({pages:n=[],subPackages:e=[],uniIdRouter:t={}}=bt){let{loginPage:s,needLogin:o=[],resToLogin:i=!0}=t,{needLoginPage:r,notNeedLoginPage:u}=Ct(n),{needLoginPage:l,notNeedLoginPage:a}=function(d=[]){let _=[],w=[];return d.forEach(F=>{let{root:T,pages:f=[]}=F,{needLoginPage:c,notNeedLoginPage:h}=Ct(f,T);_.push(...c),w.push(...h)}),{needLoginPage:_,notNeedLoginPage:w}}(e);return{loginPage:s,routerNeedLogin:o,resToLogin:i,needLoginPage:[...r,...l],notNeedLoginPage:[...u,...a]}}();function Os(n){let e=function(t){let s=getCurrentPages(),o=s[s.length-1].route,i=t.charAt(0),r=t.split("?")[0];if(i==="/")return r;let u=r.replace(/^\//,"").split("/"),l=o.split("/");l.pop();for(let a=0;a<u.length;a++){let d=u[a];d===".."?l.pop():d!=="."&&l.push(d)}return l[0]===""&&l.shift(),l.join("/")}(n).replace(/^\//,"");return!(Ds.indexOf(e)>-1)&&(Is.indexOf(e)>-1||Ps.some(t=>function(s,o){return new RegExp(o).test(s)}(n,t)))}function tn(n,e){return n.charAt(0)!=="/"&&(n="/"+n),e?n.indexOf("?")>-1?n+`&uniIdRedirectUrl=${encodeURIComponent(e)}`:n+`?uniIdRedirectUrl=${encodeURIComponent(e)}`:n}function bs(){let n=["navigateTo","redirectTo","reLaunch","switchTab"];for(let e=0;e<n.length;e++){let t=n[e];uni.addInterceptor(t,{invoke(s){let{token:o,tokenExpired:i}=Le(),r;if(o){if(i<Date.now()){let u="uni-id-token-expired";r={errCode:u,errMsg:tt[u]}}}else{let u="uni-id-check-token-failed";r={errCode:u,errMsg:tt[u]}}if(Os(s.url)&&r){if(r.uniIdRedirectUrl=s.url,ue(X).length>0)return setTimeout(()=>{B(X,r)},0),s.url="",!1;if(!xe)return s;s.url=tn(xe,r.uniIdRedirectUrl)}return s}})}}function xs(){this.onResponse(n=>{let{type:e,content:t}=n,s=!1;switch(e){case"cloudobject":s=function(o){let{errCode:i}=o;return i in tt}(t);break;case"clientdb":s=function(o){let{errCode:i}=o;return i in Ts}(t)}s&&function(o={}){let i=ue(X),r=getCurrentPages(),u=r[r.length-1],l=u&&u.$page&&u.$page.fullPath;if(i.length>0)return B(X,Object.assign({uniIdRedirectUrl:l},o));xe&&uni.navigateTo({url:tn(xe,l)})}(t)})}function Ls(n){n.onNeedLogin=function(e){We(X,e)},n.offNeedLogin=function(e){ze(X,e)},Ss&&(ie("uni-cloud-status").needLoginInit||(ie("uni-cloud-status").needLoginInit=!0,function e(){let t=getCurrentPages();t&&t[0]?bs.call(n):setTimeout(()=>{e()},30)}(),Cs&&xs.call(n)))}function Us(n){(function(e){e.onResponse=function(t){We(K,t)},e.offResponse=function(t){ze(K,t)}})(n),Ls(n),function(e){e.onRefreshToken=function(t){We(Se,t)},e.offRefreshToken=function(t){ze(Se,t)}}(n)}var nn,ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Bs=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function Rs(){let n=Le().token||"",e=n.split(".");if(!n||e.length!==3)return{uid:null,role:[],permission:[],tokenExpired:0};let t;try{t=JSON.parse((s=e[1],decodeURIComponent(nn(s).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch(o){throw new Error("\u83B7\u53D6\u5F53\u524D\u7528\u6237\u4FE1\u606F\u51FA\u9519\uFF0C\u8BE6\u7EC6\u9519\u8BEF\u4FE1\u606F\u4E3A\uFF1A"+o.message)}var s;return t.tokenExpired=1e3*t.exp,delete t.exp,delete t.iat,t}nn=typeof atob!="function"?function(n){if(n=String(n).replace(/[\t\n\f\r ]+/g,""),!Bs.test(n))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var e;n+="==".slice(2-(3&n.length));for(var t,s,o="",i=0;i<n.length;)e=ke.indexOf(n.charAt(i++))<<18|ke.indexOf(n.charAt(i++))<<12|(t=ke.indexOf(n.charAt(i++)))<<6|(s=ke.indexOf(n.charAt(i++))),o+=t===64?String.fromCharCode(e>>16&255):s===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,255&e);return o}:atob;var Ns=te(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});let t="chooseAndUploadFile:ok",s="chooseAndUploadFile:fail";function o(r,u){return r.tempFiles.forEach((l,a)=>{l.name||(l.name=l.path.substring(l.path.lastIndexOf("/")+1)),u&&(l.fileType=u),l.cloudPath=Date.now()+"_"+a+l.name.substring(l.name.lastIndexOf("."))}),r.tempFilePaths||(r.tempFilePaths=r.tempFiles.map(l=>l.path)),r}function i(r,u,{onChooseFile:l,onUploadProgress:a}){return u.then(d=>{if(l){let _=l(d);if(_!==void 0)return Promise.resolve(_).then(w=>w===void 0?d:w)}return d}).then(d=>d===!1?{errMsg:t,tempFilePaths:[],tempFiles:[]}:function(_,w,F=5,T){(w=Object.assign({},w)).errMsg=t;let f=w.tempFiles,c=f.length,h=0;return new Promise(E=>{for(;h<F;)v();function v(){let A=h++;if(A>=c)return void(!f.find(S=>!S.url&&!S.errMsg)&&E(w));let k=f[A];_.uploadFile({filePath:k.path,cloudPath:k.cloudPath,fileType:k.fileType,onUploadProgress(S){S.index=A,S.tempFile=k,S.tempFilePath=k.path,T&&T(S)}}).then(S=>{k.url=S.fileID,A<c&&v()}).catch(S=>{k.errMsg=S.errMsg||S.message,A<c&&v()})}})}(r,d,5,a))}e.initChooseAndUploadFile=function(r){return function(u={type:"all"}){return u.type==="image"?i(r,function(l){let{count:a,sizeType:d,sourceType:_=["album","camera"],extension:w}=l;return new Promise((F,T)=>{uni.chooseImage({count:a,sizeType:d,sourceType:_,extension:w,success(f){F(o(f,"image"))},fail(f){T({errMsg:f.errMsg.replace("chooseImage:fail",s)})}})})}(u),u):u.type==="video"?i(r,function(l){let{camera:a,compressed:d,maxDuration:_,sourceType:w=["album","camera"],extension:F}=l;return new Promise((T,f)=>{uni.chooseVideo({camera:a,compressed:d,maxDuration:_,sourceType:w,extension:F,success(c){let{tempFilePath:h,duration:E,size:v,height:A,width:k}=c;T(o({errMsg:"chooseVideo:ok",tempFilePaths:[h],tempFiles:[{name:c.tempFile&&c.tempFile.name||"",path:h,size:v,type:c.tempFile&&c.tempFile.type||"",width:k,height:A,duration:E,fileType:"video",cloudPath:""}]},"video"))},fail(c){f({errMsg:c.errMsg.replace("chooseVideo:fail",s)})}})})}(u),u):i(r,function(l){let{count:a,extension:d}=l;return new Promise((_,w)=>{let F=uni.chooseFile;if(typeof wx!="undefined"&&typeof wx.chooseMessageFile=="function"&&(F=wx.chooseMessageFile),typeof F!="function")return w({errMsg:s+" \u8BF7\u6307\u5B9A type \u7C7B\u578B\uFF0C\u8BE5\u5E73\u53F0\u4EC5\u652F\u6301\u9009\u62E9 image \u6216 video\u3002"});F({type:"all",count:a,extension:d,success(T){_(o(T))},fail(T){w({errMsg:T.errMsg.replace("chooseFile:fail",s)})}})})}(u),u)}}}),qs=Hn(Ns),js="manual";function sn(n){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{}}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch(()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach(t=>{e.push(this[t])}),e},(e,t)=>{if(this.loadtime===js)return;let s=!1,o=[];for(let i=2;i<e.length;i++)e[i]!==t[i]&&(o.push(e[i]),s=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(s,o)})},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:s}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomGet().then(o=>{this.mixinDatacomLoading=!1;let{data:i,count:r}=o.result;this.getcount&&(this.mixinDatacomPage.count=r),this.mixinDatacomHasMore=i.length<this.pageSize;let u=e?i.length?i[0]:void 0:i;this.mixinDatacomResData=u,t&&t(u)}).catch(o=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=o,s&&s(o)}))},mixinDatacomGet(e={}){let t=n.database(this.spaceInfo),s=e.action||this.action;s&&(t=t.action(s));let o=e.collection||this.collection;t=Array.isArray(o)?t.collection(...o):t.collection(o);let i=e.where||this.where;i&&Object.keys(i).length&&(t=t.where(i));let r=e.field||this.field;r&&(t=t.field(r));let u=e.foreignKey||this.foreignKey;u&&(t=t.foreignKey(u));let l=e.groupby||this.groupby;l&&(t=t.groupBy(l));let a=e.groupField||this.groupField;a&&(t=t.groupField(a)),(e.distinct!==void 0?e.distinct:this.distinct)===!0&&(t=t.distinct());let d=e.orderby||this.orderby;d&&(t=t.orderBy(d));let _=e.pageCurrent!==void 0?e.pageCurrent:this.mixinDatacomPage.current,w=e.pageSize!==void 0?e.pageSize:this.mixinDatacomPage.size,F=e.getcount!==void 0?e.getcount:this.getcount,T=e.gettree!==void 0?e.gettree:this.gettree,f=e.gettreepath!==void 0?e.gettreepath:this.gettreepath,c={getCount:F},h={limitLevel:e.limitlevel!==void 0?e.limitlevel:this.limitlevel,startWith:e.startwith!==void 0?e.startwith:this.startwith};return T&&(c.getTree=h),f&&(c.getTreePath=h),t=t.skip(w*(_-1)).limit(w).get(c),t}}}}function Ms(n){return function(e,t={}){t=function(u,l={}){return u.customUI=l.customUI||u.customUI,Object.assign(u.loadingOptions,l.loadingOptions),Object.assign(u.errorOptions,l.errorOptions),u}({customUI:!1,loadingOptions:{title:"\u52A0\u8F7D\u4E2D...",mask:!0},errorOptions:{type:"modal",retry:!1}},t);let{customUI:s,loadingOptions:o,errorOptions:i}=t,r=!s;return new Proxy({},{get:(u,l)=>function a(...d){return C(this,null,function*(){let _;r&&uni.showLoading({title:o.title,mask:o.mask});try{_=yield n.callFunction({name:e,type:zn,data:{method:l,params:d}})}catch(f){_={result:f}}let{errCode:w,errMsg:F,newToken:T}=_.result||{};if(r&&uni.hideLoading(),T&&T.token&&T.tokenExpired&&(Gt(T),B(Se,x({},T))),w){if(r)if(i.type==="toast")uni.showToast({title:F,icon:"none"});else{if(i.type!=="modal")throw new Error(`Invalid errorOptions.type: ${i.type}`);{let{confirm:c}=yield function(){return C(this,arguments,function*({title:h,content:E,showCancel:v,cancelText:A,confirmText:k}={}){return new Promise((S,O)=>{uni.showModal({title:h,content:E,showCancel:v,cancelText:A,confirmText:k,success(I){S(I)},fail(){S({confirm:!1,cancel:!0})}})})})}({title:"\u63D0\u793A",content:F,showCancel:i.retry,cancelText:"\u53D6\u6D88",confirmText:i.retry?"\u91CD\u8BD5":"\u786E\u5B9A"});if(i.retry&&c)return a(...d)}}let f=new P({code:w,message:F,requestId:_.requestId});throw f.detail=_.result,B(K,{type:gt,content:f}),f}return B(K,{type:gt,content:_.result}),_.result})}})}}function It(n){if(n.initUniCloudStatus&&n.initUniCloudStatus!=="rejected")return;let e=Promise.resolve();var t;t=1,e=new Promise((o,i)=>{setTimeout(()=>{o()},t)}),n.isReady=!1,n.isDefault=!1;let s=n.auth();n.initUniCloudStatus="pending",n.initUniCloud=e.then(()=>s.getLoginState()).then(o=>o?Promise.resolve():s.signInAnonymously()).then(()=>Promise.resolve()).then(({address:o,port:i}={})=>Promise.resolve()).then(()=>{n.isReady=!0,n.initUniCloudStatus="fulfilled"}).catch(o=>{console.error(o),n.initUniCloudStatus="rejected"})}var q=new class{init(n){let e={},t=n.debugFunction!==!1&&Ut&&Bt==="app-plus";switch(n.provider){case"tcb":case"tencent":e=ms.init(Object.assign(n,{useDebugFunction:t}));break;case"aliyun":e=Zn.init(Object.assign(n,{useDebugFunction:t}));break;case"private":e=_s.init(Object.assign(n,{useDebugFunction:t}));break;default:throw new Error("\u672A\u63D0\u4F9B\u6B63\u786E\u7684provider\u53C2\u6570")}return It(e),e.reInit=function(){It(this)},vs(e),function(s){let o=s.uploadFile;s.uploadFile=function(i){return o.call(this,i)}}(e),ks(e),function(s){s.getCurrentUserInfo=Rs,s.chooseAndUploadFile=qs.initChooseAndUploadFile(s),Object.assign(s,{get mixinDatacom(){return sn(s)}}),s.importObject=Ms(s)}(e),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach(s=>{if(!e[s])return;let o=e[s];e[s]=function(){return e.reInit(),o.apply(e,Array.from(arguments))},e[s]=qt(e[s],s).bind(e)}),e.init=this.init,e}};(()=>{{let n=Jn,e={};if(n.length===1)e=n[0],q=q.init(e),q.isDefault=!0;else{let t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","database","getCurrentUSerInfo","importObject"],s;s=n&&n.length>0?"\u5E94\u7528\u6709\u591A\u4E2A\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u901A\u8FC7uniCloud.init\u65B9\u6CD5\u6307\u5B9A\u8981\u4F7F\u7528\u7684\u670D\u52A1\u7A7A\u95F4":"\u5E94\u7528\u672A\u5173\u8054\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u5728uniCloud\u76EE\u5F55\u53F3\u952E\u5173\u8054\u670D\u52A1\u7A7A\u95F4",t.forEach(o=>{q[o]=function(){return console.error(s),Promise.reject(new P({code:"SYS_ERR",message:s}))}})}Object.assign(q,{get mixinDatacom(){return sn(q)}}),Us(q),q.addInterceptor=Yn,q.removeInterceptor=Gn}})();var it=q,$s=function(){var n=new Date,e=n.getFullYear(),t=n.getMonth()+1,s=n.getDate(),o=n.getHours(),i=n.getMinutes(),r=n.getSeconds(),u=e+"-"+t+"-"+s+" "+o+":"+i+":"+r;return u},on={now:$s};var D=mn(an());var un=(n,e)=>{let t=n.__vccOpts||n;for(let[s,o]of e)t[s]=o;return t};var Ks={content:{"":{flex:1}},"uni-padding-wrap":{"":{marginTop:"30rpx",marginBottom:"30rpx",marginLeft:"30rpx",marginRight:"30rpx"}}},Hs={data(){return{latitude:"",longitude:"",markers:[],circles:[]}},onLoad(){let n=this;uni.getSystemInfo({success:e=>{n.mapHeight=e.screenHeight-e.statusBarHeight-150,n.mapHeight=n.mapHeight}})},methods:{getLocationInfo(){let n=this;uni.getSystemInfo({success:function(e){n.deviceId=e.deviceId},fail:function(e){N("log","at pages/index/index.nvue:44",e)}}),N("log","at pages/index/index.nvue:47","\u672C\u673A\u8BBE\u5907ID\uFF1A"+this.deviceId),it.callFunction({name:"readUserData",data:{deviceID:this.deviceId}}).then(e=>{var t=e.result.data,s=t[0].deviceID;N("log","at pages/index/index.nvue:57","\u8BFB\u53D6\u8BBE\u5907ID\uFF1A"+s),this.deviceId==s&&(uni.getLocation({type:"gcj02",isHighAccuracy:!0,success:function(o){n.latitude=o.latitude,n.longitude=o.longitude,N("log","at pages/index/index.nvue:65",o),n.markers=[{id:0,latitude:o.latitude,longitude:o.longitude,iconPath:"/static/location.png"}],n.circles=[{latitude:o.latitude,longitude:o.longitude,color:"#A7B6CB",radius:30,strokeWidth:5}]},fail:function(o){N("log","at pages/index/index.nvue:82",o)}}),N("log","at pages/index/index.nvue:85","\u5F53\u524D\u7EAC\u5EA6\uFF1A"+this.latitude),N("log","at pages/index/index.nvue:86","\u5F53\u524D\u7ECF\u5EA6\uFF1A"+this.longitude),it.callFunction({name:"insertPositionData",data:{deviceID:this.deviceId,latitude:this.latitude,longitude:this.longitude,createTime:on.now()}}).then(o=>{N("log","at pages/index/index.nvue:97",o)}).catch(o=>{N("log","at pages/index/index.nvue:99",o)}))}).catch(e=>{uni.hideLoading(),uni.showModal({content:"\u8BF7\u5148\u6CE8\u518C",showCancel:!1}),N("log","at pages/index/index.nvue:108",e)})}}};function Ws(n,e,t,s,o,i){let r=(0,D.resolveComponent)("button");return(0,D.openBlock)(),(0,D.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,D.createElementVNode)("view",{class:"content"},[(0,D.createElementVNode)("map",{scale:18,onUpdated:e[0]||(e[0]=u=>i.getLocationInfo()),style:(0,D.normalizeStyle)([{width:"100%"},{height:n.mapHeight+"px"}]),longitude:o.longitude,latitude:o.latitude,markers:o.markers,circles:o.circles},null,44,["longitude","latitude","markers","circles"])]),(0,D.createElementVNode)("view",{class:"uni-padding-wrap uni-common-mt"},[(0,D.createVNode)(r,{type:"primary",onClick:e[1]||(e[1]=u=>i.getLocationInfo())},{default:(0,D.withCtx)(()=>[(0,D.createTextVNode)("\u5237\u65B0\u4F4D\u7F6E")]),_:1})])])}var Ue=un(Hs,[["render",Ws],["styles",[Ks]]]);var rt=plus.webview.currentWebview();if(rt){let n=parseInt(rt.id),e="pages/index/index",t={};try{t=JSON.parse(rt.__query__)}catch(o){}Ue.mpType="page";let s=Vue.createPageApp(Ue,{$store:getApp({allowDefault:!0}).$store,__pageId:n,__pagePath:e,__pageQuery:t});s.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...Ue.styles||[]])),s.mount("#root")}})();
