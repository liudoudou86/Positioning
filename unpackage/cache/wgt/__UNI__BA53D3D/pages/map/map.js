"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var Vt=Object.create;var Ze=Object.defineProperty;var Gt=Object.getOwnPropertyDescriptor;var Yt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,Xt=Object.prototype.hasOwnProperty;var Zt=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var es=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Yt(e))!Xt.call(s,r)&&r!==t&&Ze(s,r,{get:()=>e[r],enumerable:!(n=Gt(e,r))||n.enumerable});return s};var ts=(s,e,t)=>(t=s!=null?Vt(Qt(s)):{},es(e||!s||!s.__esModule?Ze(t,"default",{value:s,enumerable:!0}):t,s));var P=(s,e,t)=>new Promise((n,r)=>{var o=l=>{try{u(t.next(l))}catch(a){r(a)}},i=l=>{try{u(t.throw(l))}catch(a){r(a)}},u=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,i);u((t=t.apply(s,e)).next())});var rt=Zt((En,nt)=>{nt.exports=Vue});var ss=Object.prototype.toString,et=s=>ss.call(s),tt=s=>et(s).slice(8,-1);function ns(){return typeof __channelId__=="string"&&__channelId__}function rs(s,e){switch(tt(e)){case"Function":return"function() { [native code] }";default:return e}}function os(s,e,t){return ns()?(t.push(e.replace("at ","uni-app:///")),console[s].apply(console,t)):t.map(function(r){let o=et(r).toLowerCase();if(["[object object]","[object array]","[object module]"].indexOf(o)!==-1)try{r="---BEGIN:JSON---"+JSON.stringify(r,rs)+"---END:JSON---"}catch(i){r=o}else if(r===null)r="---NULL---";else if(r===void 0)r="---UNDEFINED---";else{let i=tt(r).toUpperCase();i==="NUMBER"||i==="BOOLEAN"?r="---BEGIN:"+i+"---"+r+"---END:"+i+"---":r=String(r)}return r}).join("---COMMA---")+" "+e}function J(s,e,...t){let n=os(s,e,t);n&&console[s](n)}var st=(s,e)=>{let t=s.__vccOpts||s;for(let[n,r]of e)t[n]=r;return t};var $=ts(rt()),is=Object.defineProperty,as=Object.defineProperties,us=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,cs=Object.prototype.hasOwnProperty,ls=Object.prototype.propertyIsEnumerable,it=(s,e,t)=>e in s?is(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,b=(s,e)=>{for(var t in e||(e={}))cs.call(e,t)&&it(s,t,e[t]);if(ot)for(var t of ot(e))ls.call(e,t)&&it(s,t,e[t]);return s},se=(s,e)=>as(s,us(e)),hs=Array.isArray,ds=s=>s!==null&&typeof s=="object",fs=["{","}"],Re=class{constructor(){this._caches=Object.create(null)}interpolate(e,t,n=fs){if(!t)return[e];let r=this._caches[e];return r||(r=ms(e,n),this._caches[e]=r),ys(r,t)}},ps=/^(?:\d)+/,gs=/^(?:\w)+/;function ms(s,[e,t]){let n=[],r=0,o="";for(;r<s.length;){let i=s[r++];if(i===e){o&&n.push({type:"text",value:o}),o="";let u="";for(i=s[r++];i!==void 0&&i!==t;)u+=i,i=s[r++];let l=i===t,a=ps.test(u)?"list":l&&gs.test(u)?"named":"unknown";n.push({value:u,type:a})}else o+=i}return o&&n.push({type:"text",value:o}),n}function ys(s,e){let t=[],n=0,r=hs(e)?"list":ds(e)?"named":"unknown";if(r==="unknown")return t;for(;n<s.length;){let o=s[n];switch(o.type){case"text":t.push(o.value);break;case"list":t.push(e[parseInt(o.value,10)]);break;case"named":r==="named"&&t.push(e[o.value]);break}n++}return t}var Oe="zh-Hans",at="zh-Hant",Y="en",_s="fr",As="es",ws=Object.prototype.hasOwnProperty,ut=(s,e)=>ws.call(s,e),Es=new Re;function Fs(s,e){return!!e.find(t=>s.indexOf(t)!==-1)}function ks(s,e){return e.find(t=>s.indexOf(t)===0)}function ct(s,e){if(!s)return;if(s=s.trim().replace(/_/g,"-"),e&&e[s])return s;if(s=s.toLowerCase(),s==="chinese")return Oe;if(s.indexOf("zh")===0)return s.indexOf("-hans")>-1?Oe:s.indexOf("-hant")>-1||Fs(s,["-tw","-hk","-mo","-cht"])?at:Oe;let t=ks(s,[Y,_s,As]);if(t)return t}var Be=class{constructor({locale:e,fallbackLocale:t,messages:n,watcher:r,formater:o}){this.locale=Y,this.fallbackLocale=Y,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=o||Es,this.messages=n||{},this.setLocale(e||Y),r&&this.watchLocale(r)}setLocale(e){let t=this.locale;this.locale=ct(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach(n=>{n(this.locale,t)})}getLocale(){return this.locale}watchLocale(e){let t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,n=!0){let r=this.messages[e];r?n?Object.assign(r,t):Object.keys(t).forEach(o=>{ut(r,o)||(r[o]=t[o])}):this.messages[e]=t}f(e,t,n){return this.formater.interpolate(e,t,n).join("")}t(e,t,n){let r=this.message;return typeof t=="string"?(t=ct(t,this.messages),t&&(r=this.messages[t])):n=t,ut(r,e)?this.formater.interpolate(r[e],n).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}};function vs(s,e){s.$watchLocale?s.$watchLocale(t=>{e.setLocale(t)}):s.$watch(()=>s.$locale,t=>{e.setLocale(t)})}function Ss(){return typeof uni!="undefined"&&uni.getLocale?uni.getLocale():typeof global!="undefined"&&global.getLocale?global.getLocale():Y}function Ts(s,e={},t,n){typeof s!="string"&&([s,e]=[e,s]),typeof s!="string"&&(s=Ss()),typeof t!="string"&&(t=typeof __uniConfig!="undefined"&&__uniConfig.fallbackLocale||Y);let r=new Be({locale:s,fallbackLocale:t,messages:e,watcher:n}),o=(i,u)=>{if(typeof getApp!="function")o=function(l,a){return r.t(l,a)};else{let l=!1;o=function(a,d){let A=getApp().$vm;return A&&(A.$locale,l||(l=!0,vs(A,r))),r.t(a,d)}}return o(i,u)};return{i18n:r,f(i,u,l){return r.f(i,u,l)},t(i,u){return o(i,u)},add(i,u,l=!0){return r.add(i,u,l)},watch(i){return r.watchLocale(i)},getLocale(){return r.getLocale()},setLocale(i){return r.setLocale(i)}}}function Cs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Z(s,e,t){return s(t={path:e,exports:{},require:function(n,r){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(r==null&&t.path)}},t.exports),t.exports}var Ie=Z(function(s,e){var t;s.exports=(t=t||function(n,r){var o=Object.create||function(){function c(){}return function(h){var E;return c.prototype=h,E=new c,c.prototype=null,E}}(),i={},u=i.lib={},l=u.Base={extend:function(c){var h=o(this);return c&&h.mixIn(c),h.hasOwnProperty("init")&&this.init!==h.init||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var h in c)c.hasOwnProperty(h)&&(this[h]=c[h]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}},a=u.WordArray=l.extend({init:function(c,h){c=this.words=c||[],this.sigBytes=h!=r?h:4*c.length},toString:function(c){return(c||A).stringify(this)},concat:function(c){var h=this.words,E=c.words,w=this.sigBytes,_=c.sigBytes;if(this.clamp(),w%4)for(var v=0;v<_;v++){var S=E[v>>>2]>>>24-v%4*8&255;h[w+v>>>2]|=S<<24-(w+v)%4*8}else for(v=0;v<_;v+=4)h[w+v>>>2]=E[v>>>2];return this.sigBytes+=_,this},clamp:function(){var c=this.words,h=this.sigBytes;c[h>>>2]&=4294967295<<32-h%4*8,c.length=n.ceil(h/4)},clone:function(){var c=l.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var h,E=[],w=function(S){S=S;var I=987654321,O=4294967295;return function(){var j=((I=36969*(65535&I)+(I>>16)&O)<<16)+(S=18e3*(65535&S)+(S>>16)&O)&O;return j/=4294967296,(j+=.5)*(n.random()>.5?1:-1)}},_=0;_<c;_+=4){var v=w(4294967296*(h||n.random()));h=987654071*v(),E.push(4294967296*v()|0)}return new a.init(E,c)}}),d=i.enc={},A=d.Hex={stringify:function(c){for(var h=c.words,E=c.sigBytes,w=[],_=0;_<E;_++){var v=h[_>>>2]>>>24-_%4*8&255;w.push((v>>>4).toString(16)),w.push((15&v).toString(16))}return w.join("")},parse:function(c){for(var h=c.length,E=[],w=0;w<h;w+=2)E[w>>>3]|=parseInt(c.substr(w,2),16)<<24-w%8*4;return new a.init(E,h/2)}},F=d.Latin1={stringify:function(c){for(var h=c.words,E=c.sigBytes,w=[],_=0;_<E;_++){var v=h[_>>>2]>>>24-_%4*8&255;w.push(String.fromCharCode(v))}return w.join("")},parse:function(c){for(var h=c.length,E=[],w=0;w<h;w++)E[w>>>2]|=(255&c.charCodeAt(w))<<24-w%4*8;return new a.init(E,h)}},k=d.Utf8={stringify:function(c){try{return decodeURIComponent(escape(F.stringify(c)))}catch(h){throw new Error("Malformed UTF-8 data")}},parse:function(c){return F.parse(unescape(encodeURIComponent(c)))}},T=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=k.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var h=this._data,E=h.words,w=h.sigBytes,_=this.blockSize,v=w/(4*_),S=(v=c?n.ceil(v):n.max((0|v)-this._minBufferSize,0))*_,I=n.min(4*S,w);if(S){for(var O=0;O<S;O+=_)this._doProcessBlock(E,O);var j=E.splice(0,S);h.sigBytes-=I}return new a.init(j,I)},clone:function(){var c=l.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});u.Hasher=T.extend({cfg:l.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){return c&&this._append(c),this._doFinalize()},blockSize:16,_createHelper:function(c){return function(h,E){return new c.init(E).finalize(h)}},_createHmacHelper:function(c){return function(h,E){return new f.HMAC.init(c,E).finalize(h)}}});var f=i.algo={};return i}(Math),t)}),Ps=(Z(function(s,e){var t;s.exports=(t=Ie,function(n){var r=t,o=r.lib,i=o.WordArray,u=o.Hasher,l=r.algo,a=[];(function(){for(var f=0;f<64;f++)a[f]=4294967296*n.abs(n.sin(f+1))|0})();var d=l.MD5=u.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(f,c){for(var h=0;h<16;h++){var E=c+h,w=f[E];f[E]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var _=this._hash.words,v=f[c+0],S=f[c+1],I=f[c+2],O=f[c+3],j=f[c+4],ae=f[c+5],ue=f[c+6],ce=f[c+7],le=f[c+8],he=f[c+9],de=f[c+10],fe=f[c+11],pe=f[c+12],ge=f[c+13],me=f[c+14],ye=f[c+15],p=_[0],y=_[1],g=_[2],m=_[3];p=A(p,y,g,m,v,7,a[0]),m=A(m,p,y,g,S,12,a[1]),g=A(g,m,p,y,I,17,a[2]),y=A(y,g,m,p,O,22,a[3]),p=A(p,y,g,m,j,7,a[4]),m=A(m,p,y,g,ae,12,a[5]),g=A(g,m,p,y,ue,17,a[6]),y=A(y,g,m,p,ce,22,a[7]),p=A(p,y,g,m,le,7,a[8]),m=A(m,p,y,g,he,12,a[9]),g=A(g,m,p,y,de,17,a[10]),y=A(y,g,m,p,fe,22,a[11]),p=A(p,y,g,m,pe,7,a[12]),m=A(m,p,y,g,ge,12,a[13]),g=A(g,m,p,y,me,17,a[14]),p=F(p,y=A(y,g,m,p,ye,22,a[15]),g,m,S,5,a[16]),m=F(m,p,y,g,ue,9,a[17]),g=F(g,m,p,y,fe,14,a[18]),y=F(y,g,m,p,v,20,a[19]),p=F(p,y,g,m,ae,5,a[20]),m=F(m,p,y,g,de,9,a[21]),g=F(g,m,p,y,ye,14,a[22]),y=F(y,g,m,p,j,20,a[23]),p=F(p,y,g,m,he,5,a[24]),m=F(m,p,y,g,me,9,a[25]),g=F(g,m,p,y,O,14,a[26]),y=F(y,g,m,p,le,20,a[27]),p=F(p,y,g,m,ge,5,a[28]),m=F(m,p,y,g,I,9,a[29]),g=F(g,m,p,y,ce,14,a[30]),p=k(p,y=F(y,g,m,p,pe,20,a[31]),g,m,ae,4,a[32]),m=k(m,p,y,g,le,11,a[33]),g=k(g,m,p,y,fe,16,a[34]),y=k(y,g,m,p,me,23,a[35]),p=k(p,y,g,m,S,4,a[36]),m=k(m,p,y,g,j,11,a[37]),g=k(g,m,p,y,ce,16,a[38]),y=k(y,g,m,p,de,23,a[39]),p=k(p,y,g,m,ge,4,a[40]),m=k(m,p,y,g,v,11,a[41]),g=k(g,m,p,y,O,16,a[42]),y=k(y,g,m,p,ue,23,a[43]),p=k(p,y,g,m,he,4,a[44]),m=k(m,p,y,g,pe,11,a[45]),g=k(g,m,p,y,ye,16,a[46]),p=T(p,y=k(y,g,m,p,I,23,a[47]),g,m,v,6,a[48]),m=T(m,p,y,g,ce,10,a[49]),g=T(g,m,p,y,me,15,a[50]),y=T(y,g,m,p,ae,21,a[51]),p=T(p,y,g,m,pe,6,a[52]),m=T(m,p,y,g,O,10,a[53]),g=T(g,m,p,y,de,15,a[54]),y=T(y,g,m,p,S,21,a[55]),p=T(p,y,g,m,le,6,a[56]),m=T(m,p,y,g,ye,10,a[57]),g=T(g,m,p,y,ue,15,a[58]),y=T(y,g,m,p,ge,21,a[59]),p=T(p,y,g,m,j,6,a[60]),m=T(m,p,y,g,fe,10,a[61]),g=T(g,m,p,y,I,15,a[62]),y=T(y,g,m,p,he,21,a[63]),_[0]=_[0]+p|0,_[1]=_[1]+y|0,_[2]=_[2]+g|0,_[3]=_[3]+m|0},_doFinalize:function(){var f=this._data,c=f.words,h=8*this._nDataBytes,E=8*f.sigBytes;c[E>>>5]|=128<<24-E%32;var w=n.floor(h/4294967296),_=h;c[15+(E+64>>>9<<4)]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8),c[14+(E+64>>>9<<4)]=16711935&(_<<8|_>>>24)|4278255360&(_<<24|_>>>8),f.sigBytes=4*(c.length+1),this._process();for(var v=this._hash,S=v.words,I=0;I<4;I++){var O=S[I];S[I]=16711935&(O<<8|O>>>24)|4278255360&(O<<24|O>>>8)}return v},clone:function(){var f=u.clone.call(this);return f._hash=this._hash.clone(),f}});function A(f,c,h,E,w,_,v){var S=f+(c&h|~c&E)+w+v;return(S<<_|S>>>32-_)+c}function F(f,c,h,E,w,_,v){var S=f+(c&E|h&~E)+w+v;return(S<<_|S>>>32-_)+c}function k(f,c,h,E,w,_,v){var S=f+(c^h^E)+w+v;return(S<<_|S>>>32-_)+c}function T(f,c,h,E,w,_,v){var S=f+(h^(c|~E))+w+v;return(S<<_|S>>>32-_)+c}r.MD5=u._createHelper(d),r.HmacMD5=u._createHmacHelper(d)}(Math),t.MD5)}),Z(function(s,e){var t,n,r;s.exports=(n=(t=Ie).lib.Base,r=t.enc.Utf8,void(t.algo.HMAC=n.extend({init:function(o,i){o=this._hasher=new o.init,typeof i=="string"&&(i=r.parse(i));var u=o.blockSize,l=4*u;i.sigBytes>l&&(i=o.finalize(i)),i.clamp();for(var a=this._oKey=i.clone(),d=this._iKey=i.clone(),A=a.words,F=d.words,k=0;k<u;k++)A[k]^=1549556828,F[k]^=909522486;a.sigBytes=d.sigBytes=l,this.reset()},reset:function(){var o=this._hasher;o.reset(),o.update(this._iKey)},update:function(o){return this._hasher.update(o),this},finalize:function(o){var i=this._hasher,u=i.finalize(o);return i.reset(),i.finalize(this._oKey.clone().concat(u))}})))}),Z(function(s,e){s.exports=Ie.HmacMD5})),lt="FUNCTION",Os="OBJECT",Is="CLIENT_DB";function Je(s){return Object.prototype.toString.call(s).slice(8,-1).toLowerCase()}function St(s){return Je(s)==="object"}function Tt(s){return s&&typeof s=="string"?JSON.parse(s):s}var Ct=!1,Pt="app";Tt({}.UNICLOUD_DEBUG);var Ds=Tt('[{"provider":"aliyun","spaceName":"positioning","spaceId":"5260c85d-7565-4ff8-8922-3efa92885a84","clientSecret":"AguDoCV7fAJHQXo/k0FuWQ==","endpoint":"https://api.bspapp.com"}]'),Ot="";try{Ot="__UNI__BA53D3D"}catch(s){}var De={};function Ve(s,e={}){var t,n;return t=De,n=s,Object.prototype.hasOwnProperty.call(t,n)||(De[s]=e),De[s]}var It=["invoke","success","fail","complete"],N=Ve("_globalUniCloudInterceptor");function bs(s,e){N[s]||(N[s]={}),St(e)&&Object.keys(e).forEach(t=>{It.indexOf(t)>-1&&function(n,r,o){let i=N[n][r];i||(i=N[n][r]=[]),i.indexOf(o)===-1&&typeof o=="function"&&i.push(o)}(s,t,e[t])})}function xs(s,e){N[s]||(N[s]={}),St(e)?Object.keys(e).forEach(t=>{It.indexOf(t)>-1&&function(n,r,o){let i=N[n][r];if(!i)return;let u=i.indexOf(o);u>-1&&i.splice(u,1)}(s,t,e[t])}):delete N[s]}function B(s,e){return s&&s.length!==0?s.reduce((t,n)=>t.then(()=>n(e)),Promise.resolve()):Promise.resolve()}function q(s,e){return N[s]&&N[s][e]||[]}var be=Ve("_globalUniCloudListener"),M="response",ht="clientdb",_e="cloudfunction",dt="cloudobject";function qe(s){return be[s]||(be[s]=[]),be[s]}function W(s,e){let t=qe(s);for(let n=0;n<t.length;n++)(0,t[n])(e)}function Dt(s,e){return e?function(t){let n=!1;e==="callFunction"&&(n=(t&&t.type||lt)!==lt);let r=e==="callFunction"&&!n,o;o=this.isReady?Promise.resolve():this.initUniCloud,t=t||{};let i=o.then(()=>n?Promise.resolve():B(q(e,"invoke"),t)).then(()=>s.call(this,t)).then(u=>n?Promise.resolve(u):B(q(e,"success"),u).then(()=>B(q(e,"complete"),u)).then(()=>(r&&W(M,{type:_e,content:u}),Promise.resolve(u))),u=>n?Promise.reject(u):B(q(e,"fail"),u).then(()=>B(q(e,"complete"),u)).then(()=>(W(M,{type:_e,content:u}),Promise.reject(u))));if(!(t.success||t.fail||t.complete))return i;i.then(u=>{t.success&&t.success(u),t.complete&&t.complete(u),r&&W(M,{type:_e,content:u})},u=>{t.fail&&t.fail(u),t.complete&&t.complete(u),r&&W(M,{type:_e,content:u})})}:function(t){if(!((t=t||{}).success||t.fail||t.complete))return s.call(this,t);s.call(this,t).then(n=>{t.success&&t.success(n),t.complete&&t.complete(n)},n=>{t.fail&&t.fail(n),t.complete&&t.complete(n)})}}var C=class extends Error{constructor(e){super(e.message),this.errMsg=e.message||"",this.errCode=this.code=e.code||"SYSTEM_ERROR",this.requestId=e.requestId}};function Us(){let s;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;let{scene:e,channel:t}=uni.getLaunchOptionsSync();s=e||t}}catch(e){}return s}var Ae;function bt(){let s=uni.getLocale&&uni.getLocale()||"en";if(Ae)return se(b({},Ae),{locale:s,LOCALE:s});let e=uni.getSystemInfoSync(),{deviceId:t,platform:n,osName:r,uniPlatform:o,appId:i}=e;return Ae=b({PLATFORM:o||Pt,OS:r||n,APPID:i||Ot,DEVICEID:t,channel:Us()},e),se(b({},Ae),{locale:s,LOCALE:s})}var Ee={sign:function(s,e){let t="";return Object.keys(s).sort().forEach(function(n){s[n]&&(t=t+"&"+n+"="+s[n])}),t=t.slice(1),Ps(t,e).toString()},wrappedRequest:function(s,e){return new Promise((t,n)=>{e(Object.assign(s,{complete(r){r||(r={});let o=r.data&&r.data.header&&r.data.header["x-serverless-request-id"]||r.header&&r.header["request-id"];if(!r.statusCode||r.statusCode>=400)return n(new C({code:"SYS_ERR",message:r.errMsg||"request:fail",requestId:o}));let i=r.data;if(i.error)return n(new C({code:i.error.code,message:i.error.message,requestId:o}));i.result=i.data,i.requestId=o,delete i.data,t(i)}}))})}},L={request:s=>uni.request(s),uploadFile:s=>uni.uploadFile(s),setStorageSync:(s,e)=>uni.setStorageSync(s,e),getStorageSync:s=>uni.getStorageSync(s),removeStorageSync:s=>uni.removeStorageSync(s),clearStorageSync:()=>uni.clearStorageSync()},ft={"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},{t:Ls}=Ts({"zh-Hans":{"uniCloud.init.paramRequired":"\u7F3A\u5C11\u53C2\u6570\uFF1A{param}","uniCloud.uploadFile.fileError":"filePath\u5E94\u4E3AFile\u5BF9\u8C61"},"zh-Hant":{"uniCloud.init.paramRequired":"\u7F3A\u5C11\u53C2\u6570\uFF1A{param}","uniCloud.uploadFile.fileError":"filePath\u5E94\u4E3AFile\u5BF9\u8C61"},en:ft,fr:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},es:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},ja:ft},"zh-Hans"),xt=class{constructor(s){["spaceId","clientSecret"].forEach(e=>{if(!Object.prototype.hasOwnProperty.call(s,e))throw new Error(Ls("uniCloud.init.paramRequired",{param:e}))}),this.config=Object.assign({},{endpoint:"https://api.bspapp.com"},s),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=L,this._getAccessTokenPromise=null,this._getAccessTokenPromiseStatus=null}get hasAccessToken(){return!!this.accessToken}setAccessToken(s){this.accessToken=s}requestWrapped(s){return Ee.wrappedRequest(s,this.adapter.request)}requestAuth(s){return this.requestWrapped(s)}request(s,e){return Promise.resolve().then(()=>this.hasAccessToken?e?this.requestWrapped(s):this.requestWrapped(s).catch(t=>new Promise((n,r)=>{!t||t.code!=="GATEWAY_INVALID_TOKEN"&&t.code!=="InvalidParameter.InvalidToken"?r(t):n()}).then(()=>this.getAccessToken()).then(()=>{let n=this.rebuildRequest(s);return this.request(n,!0)})):this.getAccessToken().then(()=>{let t=this.rebuildRequest(s);return this.request(t,!0)}))}rebuildRequest(s){let e=Object.assign({},s);return e.data.token=this.accessToken,e.header["x-basement-token"]=this.accessToken,e.header["x-serverless-sign"]=Ee.sign(e.data,this.config.clientSecret),e}setupRequest(s,e){let t=Object.assign({},s,{spaceId:this.config.spaceId,timestamp:Date.now()}),n={"Content-Type":"application/json"};return e!=="auth"&&(t.token=this.accessToken,n["x-basement-token"]=this.accessToken),n["x-serverless-sign"]=Ee.sign(t,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:n}}getAccessToken(){return this._getAccessTokenPromiseStatus==="pending"?this._getAccessTokenPromise:(this._getAccessTokenPromiseStatus="pending",this._getAccessTokenPromise=this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then(s=>new Promise((e,t)=>{s.result&&s.result.accessToken?(this.setAccessToken(s.result.accessToken),this._getAccessTokenPromiseStatus="fulfilled",e(this.accessToken)):(this._getAccessTokenPromiseStatus="rejected",t(new C({code:"AUTH_FAILED",message:"\u83B7\u53D6accessToken\u5931\u8D25"})))}),s=>(this._getAccessTokenPromiseStatus="rejected",Promise.reject(s))),this._getAccessTokenPromise)}authorize(){this.getAccessToken()}callFunction(s){let e={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:s.name,functionArgs:s.data||{}})};return this.request(this.setupRequest(e))}getOSSUploadOptionsFromPath(s){let e={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(s)};return this.request(this.setupRequest(e))}uploadFileToOSS({url:s,formData:e,name:t,filePath:n,fileType:r,onUploadProgress:o}){return new Promise((i,u)=>{let l=this.adapter.uploadFile({url:s,formData:e,name:t,filePath:n,fileType:r,header:{"X-OSS-server-side-encrpytion":"AES256"},success(a){a&&a.statusCode<400?i(a):u(new C({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(a){u(new C({code:a.code||"UPLOAD_FAILED",message:a.message||a.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof o=="function"&&l&&typeof l.onProgressUpdate=="function"&&l.onProgressUpdate(a=>{o({loaded:a.totalBytesSent,total:a.totalBytesExpectedToSend})})})}reportOSSUpload(s){let e={method:"serverless.file.resource.report",params:JSON.stringify(s)};return this.request(this.setupRequest(e))}uploadFile({filePath:s,cloudPath:e,fileType:t="image",onUploadProgress:n,config:r}){if(Je(e)!=="string")throw new C({code:"INVALID_PARAM",message:"cloudPath\u5FC5\u987B\u4E3A\u5B57\u7B26\u4E32\u7C7B\u578B"});if(!(e=e.trim()))throw new C({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});if(/:\/\//.test(e))throw new C({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u5408\u6CD5"});let o=r&&r.envType||this.config.envType,i,u;return this.getOSSUploadOptionsFromPath({env:o,filename:e}).then(l=>{let a=l.result;i=a.id,u="https://"+a.cdnDomain+"/"+a.ossPath;let d={url:"https://"+a.host,formData:{"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:a.accessKeyId,Signature:a.signature,host:a.host,id:i,key:a.ossPath,policy:a.policy,success_action_status:200},fileName:"file",name:"file",filePath:s,fileType:t};return this.uploadFileToOSS(Object.assign({},d,{onUploadProgress:n}))}).then(()=>this.reportOSSUpload({id:i})).then(l=>new Promise((a,d)=>{l.success?a({success:!0,filePath:s,fileID:u}):d(new C({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}))}deleteFile({fileList:s}){let e={method:"serverless.file.resource.delete",params:JSON.stringify({id:s[0]})};return this.request(this.setupRequest(e))}getTempFileURL({fileList:s}={}){return new Promise((e,t)=>{Array.isArray(s)&&s.length!==0||t(new C({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"})),e({fileList:s.map(n=>({fileID:n,tempFileURL:n}))})})}},Rs={init(s){let e=new xt(s),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}},Bs=typeof location!="undefined"&&location.protocol==="http:"?"http:":"https:",pt;(function(s){s.local="local",s.none="none",s.session="session"})(pt||(pt={}));var qs=function(){},oe=()=>{let s;if(!Promise){s=()=>{},s.promise={};let t=()=>{throw new C({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(s.promise,"then",{get:t}),Object.defineProperty(s.promise,"catch",{get:t}),s}let e=new Promise((t,n)=>{s=(r,o)=>r?n(r):t(o)});return s.promise=e,s};function Ns(s){return s===void 0}function Ms(s){return Object.prototype.toString.call(s)==="[object Null]"}var gt;function js(s){let e=(t=s,Object.prototype.toString.call(t)==="[object Array]"?s:[s]);var t;for(let n of e){let{isMatch:r,genAdapter:o,runtime:i}=n;if(r())return{adapter:o(),runtime:i}}}(function(s){s.WEB="web",s.WX_MP="wx_mp"})(gt||(gt={}));var x={adapter:null,runtime:void 0},$s=["anonymousUuidKey"],ee=class extends qs{constructor(){super(),x.adapter.root.tcbObject||(x.adapter.root.tcbObject={})}setItem(e,t){x.adapter.root.tcbObject[e]=t}getItem(e){return x.adapter.root.tcbObject[e]}removeItem(e){delete x.adapter.root.tcbObject[e]}clear(){delete x.adapter.root.tcbObject}};function mt(s,e){switch(s){case"local":return e.localStorage||new ee;case"none":return new ee;default:return e.sessionStorage||new ee}}var Fe=class{constructor(e){if(!this._storage){this._persistence=x.adapter.primaryStorage||e.persistence,this._storage=mt(this._persistence,x.adapter);let t=`access_token_${e.env}`,n=`access_token_expire_${e.env}`,r=`refresh_token_${e.env}`,o=`anonymous_uuid_${e.env}`,i=`login_type_${e.env}`,u=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:n,refreshTokenKey:r,anonymousUuidKey:o,loginTypeKey:i,userInfoKey:u}}}updatePersistence(e){if(e===this._persistence)return;let t=this._persistence==="local";this._persistence=e;let n=mt(e,x.adapter);for(let r in this.keys){let o=this.keys[r];if(t&&$s.includes(r))continue;let i=this._storage.getItem(o);Ns(i)||Ms(i)||(n.setItem(o,i),this._storage.removeItem(o))}this._storage=n}setStore(e,t,n){if(!this._storage)return;let r={version:n||"localCachev1",content:t},o=JSON.stringify(r);try{this._storage.setItem(e,o)}catch(i){throw i}}getStore(e,t){try{if(!this._storage)return}catch(r){return""}t=t||"localCachev1";let n=this._storage.getItem(e);return n&&n.indexOf(t)>=0?JSON.parse(n).content:""}removeStore(e){this._storage.removeItem(e)}},Ut={},Lt={};function ie(s){return Ut[s]}var ke=class{constructor(e,t){this.data=t||null,this.name=e}},Ne=class extends ke{constructor(e,t){super("error",{error:e,data:t}),this.error=e}},Ge=new class{constructor(){this._listeners={}}on(s,e){return function(t,n,r){r[t]=r[t]||[],r[t].push(n)}(s,e,this._listeners),this}off(s,e){return function(t,n,r){if(r&&r[t]){let o=r[t].indexOf(n);o!==-1&&r[t].splice(o,1)}}(s,e,this._listeners),this}fire(s,e){if(s instanceof Ne)return console.error(s.error),this;let t=typeof s=="string"?new ke(s,e||{}):s,n=t.name;if(this._listens(n)){t.target=this;let r=this._listeners[n]?[...this._listeners[n]]:[];for(let o of r)o.call(this,t)}return this}_listens(s){return this._listeners[s]&&this._listeners[s].length>0}};function H(s,e){Ge.on(s,e)}function U(s,e={}){Ge.fire(s,e)}function Ks(s,e){Ge.off(s,e)}var Q="loginStateChanged",Rt="loginStateExpire",z="loginTypeChanged",Me="anonymousConverted",Bt="refreshAccessToken",D;(function(s){s.ANONYMOUS="ANONYMOUS",s.WECHAT="WECHAT",s.WECHAT_PUBLIC="WECHAT-PUBLIC",s.WECHAT_OPEN="WECHAT-OPEN",s.CUSTOM="CUSTOM",s.EMAIL="EMAIL",s.USERNAME="USERNAME",s.NULL="NULL"})(D||(D={}));var yt=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],Hs={"X-SDK-Version":"1.3.5"};function xe(s,e,t){let n=s[e];s[e]=function(r){let o={},i={};t.forEach(l=>{let{data:a,headers:d}=l.call(s,r);Object.assign(o,a),Object.assign(i,d)});let u=r.data;return u&&(()=>{var l;if(l=u,Object.prototype.toString.call(l)!=="[object FormData]")r.data=b(b({},u),o);else for(let a in o)u.append(a,o[a])})(),r.headers=b(b({},r.headers||{}),i),n.call(s,r)}}function Ue(){let s=Math.random().toString(16).slice(2);return{data:{seqId:s},headers:se(b({},Hs),{"x-seqid":s})}}var je=class{constructor(e={}){var t;this.config=e,this._reqClass=new x.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`\u8BF7\u6C42\u5728${this.config.timeout/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`,restrictedMethods:["post"]}),this._cache=ie(this.config.env),this._localCache=(t=this.config.env,Lt[t]),xe(this._reqClass,"post",[Ue]),xe(this._reqClass,"upload",[Ue]),xe(this._reqClass,"download",[Ue])}post(e){return P(this,null,function*(){return yield this._reqClass.post(e)})}upload(e){return P(this,null,function*(){return yield this._reqClass.upload(e)})}download(e){return P(this,null,function*(){return yield this._reqClass.download(e)})}refreshAccessToken(){return P(this,null,function*(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=yield this._refreshAccessTokenPromise}catch(n){t=n}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e})}_refreshAccessToken(){return P(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:n,loginTypeKey:r,anonymousUuidKey:o}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let i=this._cache.getStore(n);if(!i)throw new C({message:"\u672A\u767B\u5F55CloudBase"});let u={refresh_token:i},l=yield this.request("auth.fetchAccessTokenWithRefreshToken",u);if(l.data.code){let{code:a}=l.data;if(a==="SIGN_PARAM_INVALID"||a==="REFRESH_TOKEN_EXPIRED"||a==="INVALID_REFRESH_TOKEN"){if(this._cache.getStore(r)===D.ANONYMOUS&&a==="INVALID_REFRESH_TOKEN"){let d=this._cache.getStore(o),A=this._cache.getStore(n),F=yield this.send("auth.signInAnonymously",{anonymous_uuid:d,refresh_token:A});return this.setRefreshToken(F.refresh_token),this._refreshAccessToken()}U(Rt),this._cache.removeStore(n)}throw new C({code:l.data.code,message:`\u5237\u65B0access token\u5931\u8D25\uFF1A${l.data.code}`})}if(l.data.access_token)return U(Bt),this._cache.setStore(e,l.data.access_token),this._cache.setStore(t,l.data.access_token_expire+Date.now()),{accessToken:l.data.access_token,accessTokenExpire:l.data.access_token_expire};l.data.refresh_token&&(this._cache.removeStore(n),this._cache.setStore(n,l.data.refresh_token),this._refreshAccessToken())})}getAccessToken(){return P(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:n}=this._cache.keys;if(!this._cache.getStore(n))throw new C({message:"refresh token\u4E0D\u5B58\u5728\uFF0C\u767B\u5F55\u72B6\u6001\u5F02\u5E38"});let r=this._cache.getStore(e),o=this._cache.getStore(t),i=!0;return this._shouldRefreshAccessTokenHook&&!(yield this._shouldRefreshAccessTokenHook(r,o))&&(i=!1),(!r||!o||o<Date.now())&&i?this.refreshAccessToken():{accessToken:r,accessTokenExpire:o}})}request(e,t,n){return P(this,null,function*(){let r=`x-tcb-trace_${this.config.env}`,o="application/x-www-form-urlencoded",i=b({action:e,env:this.config.env,dataVersion:"2019-08-16"},t);if(yt.indexOf(e)===-1){let{refreshTokenKey:h}=this._cache.keys;this._cache.getStore(h)&&(i.access_token=(yield this.getAccessToken()).accessToken)}let u;if(e==="storage.uploadFile"){u=new FormData;for(let h in u)u.hasOwnProperty(h)&&u[h]!==void 0&&u.append(h,i[h]);o="multipart/form-data"}else{o="application/json",u={};for(let h in i)i[h]!==void 0&&(u[h]=i[h])}let l={headers:{"content-type":o}};n&&n.onUploadProgress&&(l.onUploadProgress=n.onUploadProgress);let a=this._localCache.getStore(r);a&&(l.headers["X-TCB-Trace"]=a);let{parse:d,inQuery:A,search:F}=t,k={env:this.config.env};d&&(k.parse=!0),A&&(k=b(b({},A),k));let T=function(h,E,w={}){let _=/\?/.test(E),v="";for(let S in w)v===""?!_&&(E+="?"):v+="&",v+=`${S}=${encodeURIComponent(w[S])}`;return/^http(s)?\:\/\//.test(E+=v)?E:`${h}${E}`}(Bs,"//tcb-api.tencentcloudapi.com/web",k);F&&(T+=F);let f=yield this.post(b({url:T,data:u},l)),c=f.header&&f.header["x-tcb-trace"];if(c&&this._localCache.setStore(r,c),Number(f.status)!==200&&Number(f.statusCode)!==200||!f.data)throw new C({code:"NETWORK_ERROR",message:"network request error"});return f})}send(n){return P(this,arguments,function*(e,t={}){let r=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(r.data.code==="ACCESS_TOKEN_EXPIRED"&&yt.indexOf(e)===-1){yield this.refreshAccessToken();let o=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(o.data.code)throw new C({code:o.data.code,message:o.data.message});return o.data}if(r.data.code)throw new C({code:r.data.code,message:r.data.message});return r.data})}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:n,refreshTokenKey:r}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(n),this._cache.setStore(r,e)}},qt={};function K(s){return qt[s]}var X=class{constructor(e){this.config=e,this._cache=ie(e.env),this._request=K(e.env)}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:n,refreshTokenKey:r}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(n),this._cache.setStore(r,e)}setAccessToken(e,t){let{accessTokenKey:n,accessTokenExpireKey:r}=this._cache.keys;this._cache.setStore(n,e),this._cache.setStore(r,t)}refreshUserInfo(){return P(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}},$e=class{constructor(e){if(!e)throw new C({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=ie(this._envId),this._request=K(this._envId),this.setUserInfo()}linkWithTicket(e){if(typeof e!="string")throw new C({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if(typeof e!="string")throw new C({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}getLinkedUidList(){return P(this,null,function*(){let{data:e}=yield this._request.send("auth.getLinkedUidList",{}),t=!1,{users:n}=e;return n.forEach(r=>{r.wxOpenId&&r.wxPublicId&&(t=!0)}),{users:n,hasPrimaryUid:t}})}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}update(e){return P(this,null,function*(){let{nickName:t,gender:n,avatarUrl:r,province:o,country:i,city:u}=e,{data:l}=yield this._request.send("auth.updateUserInfo",{nickName:t,gender:n,avatarUrl:r,province:o,country:i,city:u});this.setLocalUserInfo(l)})}refresh(){return P(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setUserInfo(){let{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach(n=>{this[n]=t[n]}),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}},G=class{constructor(e){if(!e)throw new C({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=ie(e);let{refreshTokenKey:t,accessTokenKey:n,accessTokenExpireKey:r}=this._cache.keys,o=this._cache.getStore(t),i=this._cache.getStore(n),u=this._cache.getStore(r);this.credential={refreshToken:o,accessToken:i,accessTokenExpire:u},this.user=new $e(e)}get isAnonymousAuth(){return this.loginType===D.ANONYMOUS}get isCustomAuth(){return this.loginType===D.CUSTOM}get isWeixinAuth(){return this.loginType===D.WECHAT||this.loginType===D.WECHAT_OPEN||this.loginType===D.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}},te=class extends X{signIn(){return P(this,null,function*(){this._cache.updatePersistence("local");let{anonymousUuidKey:e,refreshTokenKey:t}=this._cache.keys,n=this._cache.getStore(e)||void 0,r=this._cache.getStore(t)||void 0,o=yield this._request.send("auth.signInAnonymously",{anonymous_uuid:n,refresh_token:r});if(o.uuid&&o.refresh_token){this._setAnonymousUUID(o.uuid),this.setRefreshToken(o.refresh_token),yield this._request.refreshAccessToken(),U(Q),U(z,{env:this.config.env,loginType:D.ANONYMOUS,persistence:"local"});let i=new G(this.config.env);return yield i.user.refresh(),i}throw new C({message:"\u533F\u540D\u767B\u5F55\u5931\u8D25"})})}linkAndRetrieveDataWithTicket(e){return P(this,null,function*(){let{anonymousUuidKey:t,refreshTokenKey:n}=this._cache.keys,r=this._cache.getStore(t),o=this._cache.getStore(n),i=yield this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:r,refresh_token:o,ticket:e});if(i.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(i.refresh_token),yield this._request.refreshAccessToken(),U(Me,{env:this.config.env}),U(z,{loginType:D.CUSTOM,persistence:"local"}),{credential:{refreshToken:i.refresh_token}};throw new C({message:"\u533F\u540D\u8F6C\u5316\u5931\u8D25"})})}_setAnonymousUUID(e){let{anonymousUuidKey:t,loginTypeKey:n}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(n,D.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}},ve=class extends X{signIn(e){return P(this,null,function*(){if(typeof e!="string")throw new C({param:"PARAM_ERROR",message:"ticket must be a string"});let{refreshTokenKey:t}=this._cache.keys,n=yield this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(n.refresh_token)return this.setRefreshToken(n.refresh_token),yield this._request.refreshAccessToken(),U(Q),U(z,{env:this.config.env,loginType:D.CUSTOM,persistence:this.config.persistence}),yield this.refreshUserInfo(),new G(this.config.env);throw new C({message:"\u81EA\u5B9A\u4E49\u767B\u5F55\u5931\u8D25"})})}},Se=class extends X{signIn(e,t){return P(this,null,function*(){if(typeof e!="string")throw new C({code:"PARAM_ERROR",message:"email must be a string"});let{refreshTokenKey:n}=this._cache.keys,r=yield this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(n)||""}),{refresh_token:o,access_token:i,access_token_expire:u}=r;if(o)return this.setRefreshToken(o),i&&u?this.setAccessToken(i,u):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),U(Q),U(z,{env:this.config.env,loginType:D.EMAIL,persistence:this.config.persistence}),new G(this.config.env);throw r.code?new C({code:r.code,message:`\u90AE\u7BB1\u767B\u5F55\u5931\u8D25: ${r.message}`}):new C({message:"\u90AE\u7BB1\u767B\u5F55\u5931\u8D25"})})}activate(e){return P(this,null,function*(){return this._request.send("auth.activateEndUserMail",{token:e})})}resetPasswordWithToken(e,t){return P(this,null,function*(){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})})}},Te=class extends X{signIn(e,t){return P(this,null,function*(){if(typeof e!="string")throw new C({code:"PARAM_ERROR",message:"username must be a string"});typeof t!="string"&&(t="",console.warn("password is empty"));let{refreshTokenKey:n}=this._cache.keys,r=yield this._request.send("auth.signIn",{loginType:D.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(n)||""}),{refresh_token:o,access_token_expire:i,access_token:u}=r;if(o)return this.setRefreshToken(o),u&&i?this.setAccessToken(u,i):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),U(Q),U(z,{env:this.config.env,loginType:D.USERNAME,persistence:this.config.persistence}),new G(this.config.env);throw r.code?new C({code:r.code,message:`\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25: ${r.message}`}):new C({message:"\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25"})})}},Ke=class{constructor(e){this.config=e,this._cache=ie(e.env),this._request=K(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),H(z,this._onLoginTypeChanged)}get currentUser(){let e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new te(this.config)}customAuthProvider(){return new ve(this.config)}emailAuthProvider(){return new Se(this.config)}usernameAuthProvider(){return new Te(this.config)}signInAnonymously(){return P(this,null,function*(){return new te(this.config).signIn()})}signInWithEmailAndPassword(e,t){return P(this,null,function*(){return new Se(this.config).signIn(e,t)})}signInWithUsernameAndPassword(e,t){return new Te(this.config).signIn(e,t)}linkAndRetrieveDataWithTicket(e){return P(this,null,function*(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new te(this.config)),H(Me,this._onAnonymousConverted),yield this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)})}signOut(){return P(this,null,function*(){if(this.loginType===D.ANONYMOUS)throw new C({message:"\u533F\u540D\u7528\u6237\u4E0D\u652F\u6301\u767B\u51FA\u64CD\u4F5C"});let{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:n}=this._cache.keys,r=this._cache.getStore(e);if(!r)return;let o=yield this._request.send("auth.logout",{refresh_token:r});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(n),U(Q),U(z,{env:this.config.env,loginType:D.NULL,persistence:this.config.persistence}),o})}signUpWithEmailAndPassword(e,t){return P(this,null,function*(){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})})}sendPasswordResetEmail(e){return P(this,null,function*(){return this._request.send("auth.sendPasswordResetEmail",{email:e})})}onLoginStateChanged(e){H(Q,()=>{let n=this.hasLoginState();e.call(this,n)});let t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){H(Rt,e.bind(this))}onAccessTokenRefreshed(e){H(Bt,e.bind(this))}onAnonymousConverted(e){H(Me,e.bind(this))}onLoginTypeChanged(e){H(z,()=>{let t=this.hasLoginState();e.call(this,t)})}getAccessToken(){return P(this,null,function*(){return{accessToken:(yield this._request.getAccessToken()).accessToken,env:this.config.env}})}hasLoginState(){let{refreshTokenKey:e}=this._cache.keys;return this._cache.getStore(e)?new G(this.config.env):null}isUsernameRegistered(e){return P(this,null,function*(){if(typeof e!="string")throw new C({code:"PARAM_ERROR",message:"username must be a string"});let{data:t}=yield this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered})}getLoginState(){return Promise.resolve(this.hasLoginState())}signInWithTicket(e){return P(this,null,function*(){return new ve(this.config).signIn(e)})}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then(e=>e.code?e:se(b({},e.data),{requestId:e.seqId}))}getAuthHeader(){let{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,n=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+n}}_onAnonymousConverted(e){let{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){let{loginType:t,persistence:n,env:r}=e.data;r===this.config.env&&(this._cache.updatePersistence(n),this._cache.setStore(this._cache.keys.loginTypeKey,t))}},Ws=function(s,e){e=e||oe();let t=K(this.config.env),{cloudPath:n,filePath:r,onUploadProgress:o,fileType:i="image"}=s;return t.send("storage.getUploadMetadata",{path:n}).then(u=>{let{data:{url:l,authorization:a,token:d,fileId:A,cosFileId:F},requestId:k}=u,T={key:n,signature:a,"x-cos-meta-fileid":F,success_action_status:"201","x-cos-security-token":d};t.upload({url:l,data:T,file:r,name:n,fileType:i,onUploadProgress:o}).then(f=>{f.statusCode===201?e(null,{fileID:A,requestId:k}):e(new C({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${f.data}`}))}).catch(f=>{e(f)})}).catch(u=>{e(u)}),e.promise},zs=function(s,e){e=e||oe();let t=K(this.config.env),{cloudPath:n}=s;return t.send("storage.getUploadMetadata",{path:n}).then(r=>{e(null,r)}).catch(r=>{e(r)}),e.promise},Js=function({fileList:s},e){if(e=e||oe(),!s||!Array.isArray(s))return{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"};for(let n of s)if(!n||typeof n!="string")return{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"};let t={fileid_list:s};return K(this.config.env).send("storage.batchDeleteFile",t).then(n=>{n.code?e(null,n):e(null,{fileList:n.data.delete_list,requestId:n.requestId})}).catch(n=>{e(n)}),e.promise},Nt=function({fileList:s},e){e=e||oe(),s&&Array.isArray(s)||e(null,{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"});let t=[];for(let r of s)typeof r=="object"?(r.hasOwnProperty("fileID")&&r.hasOwnProperty("maxAge")||e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5305\u542BfileID\u548CmaxAge\u7684\u5BF9\u8C61"}),t.push({fileid:r.fileID,max_age:r.maxAge})):typeof r=="string"?t.push({fileid:r}):e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5B57\u7B26\u4E32"});let n={file_list:t};return K(this.config.env).send("storage.batchGetDownloadUrl",n).then(r=>{r.code?e(null,r):e(null,{fileList:r.data.download_list,requestId:r.requestId})}).catch(r=>{e(r)}),e.promise},Vs=function(t,n){return P(this,arguments,function*({fileID:s},e){let r=(yield Nt.call(this,{fileList:[{fileID:s,maxAge:600}]})).fileList[0];if(r.code!=="SUCCESS")return e?e(r):new Promise(u=>{u(r)});let o=K(this.config.env),i=r.download_url;if(i=encodeURI(i),!e)return o.download({url:i});e(yield o.download({url:i}))})},Gs=function({name:s,data:e,query:t,parse:n,search:r},o){let i=o||oe(),u;try{u=e?JSON.stringify(e):""}catch(a){return Promise.reject(a)}if(!s)return Promise.reject(new C({code:"PARAM_ERROR",message:"\u51FD\u6570\u540D\u4E0D\u80FD\u4E3A\u7A7A"}));let l={inQuery:t,parse:n,search:r,function_name:s,request_data:u};return K(this.config.env).send("functions.invokeFunction",l).then(a=>{if(a.code)i(null,a);else{let d=a.data.response_data;if(n)i(null,{result:d,requestId:a.requestId});else try{d=JSON.parse(a.data.response_data),i(null,{result:d,requestId:a.requestId})}catch(A){i(new C({message:"response data must be json"}))}}return i.promise}).catch(a=>{i(a)}),i.promise},_t={timeout:15e3,persistence:"session"},At={},ne=class{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(x.adapter||(this.requestClient=new x.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`\u8BF7\u6C42\u5728${(e.timeout||5e3)/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`})),this.config=b(b({},_t),e),!0){case this.config.timeout>6e5:console.warn("timeout\u5927\u4E8E\u53EF\u914D\u7F6E\u4E0A\u9650[10\u5206\u949F]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0A\u9650\u6570\u503C"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("timeout\u5C0F\u4E8E\u53EF\u914D\u7F6E\u4E0B\u9650[100ms]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0B\u9650\u6570\u503C"),this.config.timeout=100}return new ne(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;let t=e||x.adapter.primaryStorage||_t.persistence;var n;return t!==this.config.persistence&&(this.config.persistence=t),function(r){let{env:o}=r;Ut[o]=new Fe(r),Lt[o]=new Fe(se(b({},r),{persistence:"local"}))}(this.config),n=this.config,qt[n.env]=new je(n),this.authObj=new Ke(this.config),this.authObj}on(e,t){return H.apply(this,[e,t])}off(e,t){return Ks.apply(this,[e,t])}callFunction(e,t){return Gs.apply(this,[e,t])}deleteFile(e,t){return Js.apply(this,[e,t])}getTempFileURL(e,t){return Nt.apply(this,[e,t])}downloadFile(e,t){return Vs.apply(this,[e,t])}uploadFile(e,t){return Ws.apply(this,[e,t])}getUploadMetadata(e,t){return zs.apply(this,[e,t])}registerExtension(e){At[e.name]=e}invokeExtension(e,t){return P(this,null,function*(){let n=At[e];if(!n)throw new C({message:`\u6269\u5C55${e} \u5FC5\u987B\u5148\u6CE8\u518C`});return yield n.invoke(t,this)})}useAdapters(e){let{adapter:t,runtime:n}=js(e)||{};t&&(x.adapter=t),n&&(x.runtime=n)}},Mt=new ne;function wt(s,e,t){t===void 0&&(t={});var n=/\?/.test(e),r="";for(var o in t)r===""?!n&&(e+="?"):r+="&",r+=o+"="+encodeURIComponent(t[o]);return/^http(s)?:\/\//.test(e+=r)?e:""+s+e}var He=class{post(e){let{url:t,data:n,headers:r}=e;return new Promise((o,i)=>{L.request({url:wt("https:",t),data:n,method:"POST",header:r,success(u){o(u)},fail(u){i(u)}})})}upload(e){return new Promise((t,n)=>{let{url:r,file:o,data:i,headers:u,fileType:l}=e,a=L.uploadFile({url:wt("https:",r),name:"file",formData:Object.assign({},i),filePath:o,fileType:l,header:u,success(d){let A={statusCode:d.statusCode,data:d.data||{}};d.statusCode===200&&i.success_action_status&&(A.statusCode=parseInt(i.success_action_status,10)),t(A)},fail(d){n(new Error(d.errMsg||"uploadFile:fail"))}});typeof e.onUploadProgress=="function"&&a&&typeof a.onProgressUpdate=="function"&&a.onProgressUpdate(d=>{e.onUploadProgress({loaded:d.totalBytesSent,total:d.totalBytesExpectedToSend})})})}},Ys={setItem(s,e){L.setStorageSync(s,e)},getItem:s=>L.getStorageSync(s),removeItem(s){L.removeStorageSync(s)},clear(){L.clearStorageSync()}},Qs={genAdapter:function(){return{root:{},reqClass:He,localStorage:Ys,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};Mt.useAdapters(Qs);var Ye=Mt,Xs=Ye.init;Ye.init=function(s){s.env=s.spaceId;let e=Xs.call(this,s);e.config.provider="tencent",e.config.spaceId=s.spaceId;let t=e.auth;return e.auth=function(n){let r=t.call(this,n);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach(o=>{r[o]=Dt(r[o]).bind(r)}),r},e.customAuth=e.auth,e};var Zs=Ye;function jt(s){return s&&jt(s.__v_raw)||s}function Qe(){return{token:L.getStorageSync("uni_id_token")||L.getStorageSync("uniIdToken"),tokenExpired:L.getStorageSync("uni_id_token_expired")}}function $t({token:s,tokenExpired:e}={}){s&&L.setStorageSync("uni_id_token",s),e&&L.setStorageSync("uni_id_token_expired",e)}var en=class extends xt{getAccessToken(){return new Promise((s,e)=>{let t="Anonymous_Access_token";this.setAccessToken(t),s(t)})}setupRequest(s,e){let t=Object.assign({},s,{spaceId:this.config.spaceId,timestamp:Date.now()}),n={"Content-Type":"application/json"};e!=="auth"&&(t.token=this.accessToken,n["x-basement-token"]=this.accessToken),n["x-serverless-sign"]=Ee.sign(t,this.config.clientSecret);let r=bt();n["x-client-info"]=JSON.stringify(r);let{token:o}=Qe();return n["x-client-token"]=o,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(n))}}uploadFileToOSS({url:s,formData:e,name:t,filePath:n,fileType:r,onUploadProgress:o}){return new Promise((i,u)=>{let l=this.adapter.uploadFile({url:s,formData:e,name:t,filePath:n,fileType:r,success(a){a&&a.statusCode<400?i(a):u(new C({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(a){u(new C({code:a.code||"UPLOAD_FAILED",message:a.message||a.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof o=="function"&&l&&typeof l.onProgressUpdate=="function"&&l.onProgressUpdate(a=>{o({loaded:a.totalBytesSent,total:a.totalBytesExpectedToSend})})})}uploadFile({filePath:s,cloudPath:e,fileType:t="image",onUploadProgress:n}){if(!e)throw new C({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});let r;return this.getOSSUploadOptionsFromPath({cloudPath:e}).then(o=>{let{url:i,formData:u,name:l}=o.result;r=o.result.fileUrl;let a={url:i,formData:u,name:l,filePath:s,fileType:t};return this.uploadFileToOSS(Object.assign({},a,{onUploadProgress:n}))}).then(()=>this.reportOSSUpload({cloudPath:e})).then(o=>new Promise((i,u)=>{o.success?i({success:!0,filePath:s,fileID:r}):u(new C({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}))}deleteFile({fileList:s}){let e={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:s})};return this.request(this.setupRequest(e))}getTempFileURL({fileList:s}={}){let e={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:s})};return this.request(this.setupRequest(e))}},tn={init(s){let e=new en(s),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}};function sn({data:s}){let e;e=bt();let t=JSON.parse(JSON.stringify(s||{}));if(Object.assign(t,{clientInfo:e}),!t.uniIdToken){let{token:n}=Qe();n&&(t.uniIdToken=n)}return t}var nn=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"\uFF0C\u4E91\u51FD\u6570[{functionName}]\u5728\u4E91\u7AEF\u4E0D\u5B58\u5728\uFF0C\u8BF7\u68C0\u67E5\u6B64\u4E91\u51FD\u6570\u540D\u79F0\u662F\u5426\u6B63\u786E\u4EE5\u53CA\u8BE5\u4E91\u51FD\u6570\u662F\u5426\u5DF2\u4E0A\u4F20\u5230\u670D\u52A1\u7A7A\u95F4",mode:"append"}],Kt=/[\\^$.*+?()[\]{}|]/g,rn=RegExp(Kt.source);function Et(s,e,t){return s.replace(new RegExp((n=e)&&rn.test(n)?n.replace(Kt,"\\$&"):n,"g"),t);var n}function Ft({functionName:s,result:e,logPvd:t}){if(this.config.useDebugFunction&&e&&e.requestId){let n=JSON.stringify({spaceId:this.config.spaceId,functionName:s,requestId:e.requestId});console.log(`[${t}-request]${n}[/${t}-request]`)}}function on(s){let e=s.callFunction,t=function(n){let r=n.name;n.data=sn.call(s,{data:n.data});let o={aliyun:"aliyun",tencent:"tcb",tcb:"tcb"}[this.config.provider];return e.call(this,n).then(i=>(i.errCode=0,Ft.call(this,{functionName:r,result:i,logPvd:o}),Promise.resolve(i)),i=>(Ft.call(this,{functionName:r,result:i,logPvd:o}),i&&i.message&&(i.message=function({message:u="",extraInfo:l={},formatter:a=[]}={}){for(let d=0;d<a.length;d++){let{rule:A,content:F,mode:k}=a[d],T=u.match(A);if(!T)continue;let f=F;for(let c=1;c<T.length;c++)f=Et(f,`{$${c}}`,T[c]);for(let c in l)f=Et(f,`{${c}}`,l[c]);return k==="replace"?f:u+f}return u}({message:`[${n.name}]: ${i.message}`,formatter:nn,extraInfo:{functionName:r}})),Promise.reject(i)))};s.callFunction=function(n){let r;return r=t.call(this,n),Object.defineProperty(r,"result",{get:()=>(console.warn("\u5F53\u524D\u8FD4\u56DE\u7ED3\u679C\u4E3APromise\u7C7B\u578B\uFF0C\u4E0D\u53EF\u76F4\u63A5\u8BBF\u95EE\u5176result\u5C5E\u6027\uFF0C\u8BE6\u60C5\u8BF7\u53C2\u8003\uFF1Ahttps://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),r}}var Ht=Symbol("CLIENT_DB_INTERNAL");function Ce(s,e){return s.then="DoNotReturnProxyWithAFunctionNamedThen",s._internalType=Ht,s.__v_raw=void 0,new Proxy(s,{get(t,n,r){if(n==="_uniClient")return null;if(n in t||typeof n!="string"){let o=t[n];return typeof o=="function"?o.bind(t):o}return e.get(t,n,r)}})}function kt(s){return{on:(e,t)=>{s[e]=s[e]||[],s[e].indexOf(t)>-1||s[e].push(t)},off:(e,t)=>{s[e]=s[e]||[];let n=s[e].indexOf(t);n!==-1&&s[e].splice(n,1)}}}var an=["db.Geo","db.command","command.aggregate"];function Wt(s,e){return an.indexOf(`${s}.${e}`)>-1}function V(s){switch(Je(s=jt(s))){case"array":return s.map(e=>V(e));case"object":return s._internalType===Ht||Object.keys(s).forEach(e=>{s[e]=V(s[e])}),s;case"regexp":return{$regexp:{source:s.source,flags:s.flags}};case"date":return{$date:s.toISOString()};default:return s}}var We=class{constructor(e,t,n){this.content=e,this.prevStage=t||null,this.udb=null,this._database=n}toJSON(){let e=this,t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map(n=>({$method:n.$method,$param:V(n.$param)}))}}getAction(){let e=this.toJSON().$db.find(t=>t.$method==="action");return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter(e=>e.$method!=="action")}}get useAggregate(){let e=this,t=!1;for(;e.prevStage;){e=e.prevStage;let n=e.content.$method;if(n==="aggregate"||n==="pipeline"){t=!0;break}}return t}get count(){if(!this.useAggregate)return function(){return this._send("count",Array.from(arguments))};let e=this;return function(){return re({$method:"count",$param:V(Array.from(arguments))},e,this._database)}}get(){return this._send("get",Array.from(arguments))}add(){return this._send("add",Array.from(arguments))}remove(){return this._send("remove",Array.from(arguments))}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}set(){throw new Error("clientDB\u7981\u6B62\u4F7F\u7528set\u65B9\u6CD5")}_send(e,t){let n=this.getAction(),r=this.getCommand();return r.$db.push({$method:e,$param:V(t)}),this._database._callCloudFunction({action:n,command:r})}};function re(s,e,t){return Ce(new We(s,e,t),{get(n,r){let o="db";return n&&n.content&&(o=n.content.$method),Wt(o,r)?re({$method:r},n,t):function(){return re({$method:r,$param:V(Array.from(arguments))},n,t)}}})}function Le({path:s,method:e}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...s.map(t=>({$method:t})),{$method:e,$param:this.param}]}}}}var ze=class extends class{constructor({uniClient:e={}}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e.isDefault&&(this._dbCallBacks=Ve("_globalUniCloudDatabaseCallback")),this.auth=kt(this._authCallBacks),Object.assign(this,kt(this._dbCallBacks)),this.env=Ce({},{get:(t,n)=>({$env:n})}),this.Geo=Ce({},{get:(t,n)=>Le({path:["Geo"],method:n})}),this.serverDate=Le({path:[],method:"serverDate"}),this.RegExp=Le({path:[],method:"RegExp"})}getCloudEnv(e){if(typeof e!="string"||!e.trim())throw new Error("getCloudEnv\u53C2\u6570\u9519\u8BEF");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){let n=this._dbCallBacks;n[e]&&n[e].forEach(r=>{r(...t)})}_callbackAuth(e,t){let n=this._authCallBacks;n[e]&&n[e].forEach(r=>{r(...t)})}multiSend(){let e=Array.from(arguments),t=e.map(n=>{let r=n.getAction(),o=n.getCommand();if(o.$db[o.$db.length-1].$method!=="getTemp")throw new Error("multiSend\u53EA\u652F\u6301\u5B50\u547D\u4EE4\u5185\u4F7F\u7528getTemp");return{action:r,command:o}});return this._callCloudFunction({multiCommand:t,queryList:e})}}{_callCloudFunction({action:e,command:t,multiCommand:n,queryList:r}){function o(d,A){if(n&&r)for(let F=0;F<r.length;F++){let k=r[F];k.udb&&typeof k.udb.setResult=="function"&&(A?k.udb.setResult(A):k.udb.setResult(d.result.dataList[F]))}}let i=this;function u(d){return i._callback("error",[d]),B(q("database","fail"),d).then(()=>B(q("database","complete"),d)).then(()=>(o(null,d),W(M,{type:ht,content:d}),Promise.reject(d)))}let l=B(q("database","invoke")),a=this._uniClient;return l.then(()=>a.callFunction({name:"DCloud-clientDB",type:Is,data:{action:e,command:t,multiCommand:n}})).then(d=>{let{code:A,message:F,token:k,tokenExpired:T,systemInfo:f=[]}=d.result;if(f)for(let h=0;h<f.length;h++){let{level:E,message:w,detail:_}=f[h],v=console[E]||console.log,S="[System Info]"+w;_&&(S=`${S}
\u8BE6\u7EC6\u4FE1\u606F\uFF1A${_}`),v(S)}if(A)return u(new C({code:A,message:F,requestId:d.requestId}));d.result.errCode=d.result.code,d.result.errMsg=d.result.message,k&&T&&($t({token:k,tokenExpired:T}),this._callbackAuth("refreshToken",[{token:k,tokenExpired:T}]),this._callback("refreshToken",[{token:k,tokenExpired:T}]));let c=[{prop:"affectedDocs",tips:"affectedDocs\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528inserted/deleted/updated/data.length\u66FF\u4EE3"},{prop:"code",tips:"code\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errCode\u66FF\u4EE3"},{prop:"message",tips:"message\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errMsg\u66FF\u4EE3"}];for(let h=0;h<c.length;h++){let{prop:E,tips:w}=c[h];if(E in d.result){let _=d.result[E];Object.defineProperty(d.result,E,{get:()=>(console.warn(w),_)})}}return function(h){return B(q("database","success"),h).then(()=>B(q("database","complete"),h)).then(()=>(o(h,null),W(M,{type:ht,content:h}),Promise.resolve(h)))}(d)},d=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(d.message)&&console.warn("clientDB\u672A\u521D\u59CB\u5316\uFF0C\u8BF7\u5728web\u63A7\u5236\u53F0\u4FDD\u5B58\u4E00\u6B21schema\u4EE5\u5F00\u542FclientDB"),u(new C({code:d.code||"SYSTEM_ERROR",message:d.message,requestId:d.requestId}))))}};function un(s){s.database=function(e){if(e&&Object.keys(e).length>0)return s.init(e).database();if(this._database)return this._database;let t=function(n,r={}){return Ce(new n(r),{get:(o,i)=>Wt("db",i)?re({$method:i},null,o):function(){return re({$method:i,$param:V(Array.from(arguments))},null,o)}})}(ze,{uniClient:s});return this._database=t,t}}function cn(s){s.onResponse=function(e){(function(t,n){let r=qe(t);r.includes(n)||r.push(n)})(M,e)},s.offResponse=function(e){(function(t,n){let r=qe(t),o=r.indexOf(n);o!==-1&&r.splice(o,1)})(M,e)}}var zt,we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ln=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function hn(){let s=Qe().token||"",e=s.split(".");if(!s||e.length!==3)return{uid:null,role:[],permission:[],tokenExpired:0};let t;try{t=JSON.parse((n=e[1],decodeURIComponent(zt(n).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch(r){throw new Error("\u83B7\u53D6\u5F53\u524D\u7528\u6237\u4FE1\u606F\u51FA\u9519\uFF0C\u8BE6\u7EC6\u9519\u8BEF\u4FE1\u606F\u4E3A\uFF1A"+r.message)}var n;return t.tokenExpired=1e3*t.exp,delete t.exp,delete t.iat,t}zt=typeof atob!="function"?function(s){if(s=String(s).replace(/[\t\n\f\r ]+/g,""),!ln.test(s))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var e;s+="==".slice(2-(3&s.length));for(var t,n,r="",o=0;o<s.length;)e=we.indexOf(s.charAt(o++))<<18|we.indexOf(s.charAt(o++))<<12|(t=we.indexOf(s.charAt(o++)))<<6|(n=we.indexOf(s.charAt(o++))),r+=t===64?String.fromCharCode(e>>16&255):n===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,255&e);return r}:atob;var dn=Cs(Z(function(s,e){Object.defineProperty(e,"__esModule",{value:!0});let t="chooseAndUploadFile:ok",n="chooseAndUploadFile:fail";function r(i,u){return i.tempFiles.forEach((l,a)=>{l.name||(l.name=l.path.substring(l.path.lastIndexOf("/")+1)),u&&(l.fileType=u),l.cloudPath=Date.now()+"_"+a+l.name.substring(l.name.lastIndexOf("."))}),i.tempFilePaths||(i.tempFilePaths=i.tempFiles.map(l=>l.path)),i}function o(i,u,{onChooseFile:l,onUploadProgress:a}){return u.then(d=>{if(l){let A=l(d);if(A!==void 0)return Promise.resolve(A).then(F=>F===void 0?d:F)}return d}).then(d=>d===!1?{errMsg:t,tempFilePaths:[],tempFiles:[]}:function(A,F,k=5,T){(F=Object.assign({},F)).errMsg=t;let f=F.tempFiles,c=f.length,h=0;return new Promise(E=>{for(;h<k;)w();function w(){let _=h++;if(_>=c)return void(!f.find(S=>!S.url&&!S.errMsg)&&E(F));let v=f[_];A.uploadFile({filePath:v.path,cloudPath:v.cloudPath,fileType:v.fileType,onUploadProgress(S){S.index=_,S.tempFile=v,S.tempFilePath=v.path,T&&T(S)}}).then(S=>{v.url=S.fileID,_<c&&w()}).catch(S=>{v.errMsg=S.errMsg||S.message,_<c&&w()})}})}(i,d,5,a))}e.initChooseAndUploadFile=function(i){return function(u={type:"all"}){return u.type==="image"?o(i,function(l){let{count:a,sizeType:d,sourceType:A=["album","camera"],extension:F}=l;return new Promise((k,T)=>{uni.chooseImage({count:a,sizeType:d,sourceType:A,extension:F,success(f){k(r(f,"image"))},fail(f){T({errMsg:f.errMsg.replace("chooseImage:fail",n)})}})})}(u),u):u.type==="video"?o(i,function(l){let{camera:a,compressed:d,maxDuration:A,sourceType:F=["album","camera"],extension:k}=l;return new Promise((T,f)=>{uni.chooseVideo({camera:a,compressed:d,maxDuration:A,sourceType:F,extension:k,success(c){let{tempFilePath:h,duration:E,size:w,height:_,width:v}=c;T(r({errMsg:"chooseVideo:ok",tempFilePaths:[h],tempFiles:[{name:c.tempFile&&c.tempFile.name||"",path:h,size:w,type:c.tempFile&&c.tempFile.type||"",width:v,height:_,duration:E,fileType:"video",cloudPath:""}]},"video"))},fail(c){f({errMsg:c.errMsg.replace("chooseVideo:fail",n)})}})})}(u),u):o(i,function(l){let{count:a,extension:d}=l;return new Promise((A,F)=>{let k=uni.chooseFile;if(typeof wx!="undefined"&&typeof wx.chooseMessageFile=="function"&&(k=wx.chooseMessageFile),typeof k!="function")return F({errMsg:n+" \u8BF7\u6307\u5B9A type \u7C7B\u578B\uFF0C\u8BE5\u5E73\u53F0\u4EC5\u652F\u6301\u9009\u62E9 image \u6216 video\u3002"});k({type:"all",count:a,extension:d,success(T){A(r(T))},fail(T){F({errMsg:T.errMsg.replace("chooseFile:fail",n)})}})})}(u),u)}}})),fn="manual";function Jt(s){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{}}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch(()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach(t=>{e.push(this[t])}),e},(e,t)=>{if(this.loadtime===fn)return;let n=!1,r=[];for(let o=2;o<e.length;o++)e[o]!==t[o]&&(r.push(e[o]),n=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(n,r)})},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:n}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomGet().then(r=>{this.mixinDatacomLoading=!1;let{data:o,count:i}=r.result;this.getcount&&(this.mixinDatacomPage.count=i),this.mixinDatacomHasMore=o.length<this.pageSize;let u=e?o.length?o[0]:void 0:o;this.mixinDatacomResData=u,t&&t(u)}).catch(r=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=r,n&&n(r)}))},mixinDatacomGet(e={}){let t=s.database(this.spaceInfo),n=e.action||this.action;n&&(t=t.action(n));let r=e.collection||this.collection;t=Array.isArray(r)?t.collection(...r):t.collection(r);let o=e.where||this.where;o&&Object.keys(o).length&&(t=t.where(o));let i=e.field||this.field;i&&(t=t.field(i));let u=e.foreignKey||this.foreignKey;u&&(t=t.foreignKey(u));let l=e.groupby||this.groupby;l&&(t=t.groupBy(l));let a=e.groupField||this.groupField;a&&(t=t.groupField(a)),(e.distinct!==void 0?e.distinct:this.distinct)===!0&&(t=t.distinct());let d=e.orderby||this.orderby;d&&(t=t.orderBy(d));let A=e.pageCurrent!==void 0?e.pageCurrent:this.mixinDatacomPage.current,F=e.pageSize!==void 0?e.pageSize:this.mixinDatacomPage.size,k=e.getcount!==void 0?e.getcount:this.getcount,T=e.gettree!==void 0?e.gettree:this.gettree,f=e.gettreepath!==void 0?e.gettreepath:this.gettreepath,c={getCount:k},h={limitLevel:e.limitlevel!==void 0?e.limitlevel:this.limitlevel,startWith:e.startwith!==void 0?e.startwith:this.startwith};return T&&(c.getTree=h),f&&(c.getTreePath=h),t=t.skip(F*(A-1)).limit(F).get(c),t}}}}function pn(s){return function(e,t={}){t=function(u,l={}){return u.customUI=l.customUI||u.customUI,Object.assign(u.loadingOptions,l.loadingOptions),Object.assign(u.errorOptions,l.errorOptions),u}({customUI:!1,loadingOptions:{title:"\u52A0\u8F7D\u4E2D...",mask:!0},errorOptions:{type:"modal",retry:!1}},t);let{customUI:n,loadingOptions:r,errorOptions:o}=t,i=!n;return new Proxy({},{get:(u,l)=>function a(...d){return P(this,null,function*(){let A;i&&uni.showLoading({title:r.title,mask:r.mask});try{A=yield s.callFunction({name:e,type:Os,data:{method:l,params:d}})}catch(f){A={result:f}}let{errCode:F,errMsg:k,newToken:T}=A.result||{};if(i&&uni.hideLoading(),T&&T.token&&T.tokenExpired&&$t(T),F){if(i)if(o.type==="toast")uni.showToast({title:k,icon:"none"});else{if(o.type!=="modal")throw new Error(`Invalid errorOptions.type: ${o.type}`);{let{confirm:c}=yield function(){return P(this,arguments,function*({title:h,content:E,showCancel:w,cancelText:_,confirmText:v}={}){return new Promise((S,I)=>{uni.showModal({title:h,content:E,showCancel:w,cancelText:_,confirmText:v,success(O){S(O)},fail(){S({confirm:!1,cancel:!0})}})})})}({title:"\u63D0\u793A",content:k,showCancel:o.retry,cancelText:"\u53D6\u6D88",confirmText:o.retry?"\u91CD\u8BD5":"\u786E\u5B9A"});if(o.retry&&c)return a(...d)}}let f=new C({code:F,message:k,requestId:A.requestId});throw f.detail=A.result,W(M,{type:dt,content:f}),f}return W(M,{type:dt,content:A.result}),A.result})}})}}function vt(s){if(s.initUniCloudStatus&&s.initUniCloudStatus!=="rejected")return;let e=Promise.resolve();var t;t=1,e=new Promise((r,o)=>{setTimeout(()=>{r()},t)}),s.isReady=!1,s.isDefault=!1;let n=s.auth();s.initUniCloudStatus="pending",s.initUniCloud=e.then(()=>n.getLoginState()).then(r=>r?Promise.resolve():n.signInAnonymously()).then(()=>Promise.resolve()).then(({address:r,port:o}={})=>Promise.resolve()).then(()=>{s.isReady=!0,s.initUniCloudStatus="fulfilled"}).catch(r=>{console.error(r),s.initUniCloudStatus="rejected"})}var R=new class{init(s){let e={},t=s.debugFunction!==!1&&Ct&&Pt==="app-plus";switch(s.provider){case"tcb":case"tencent":e=Zs.init(Object.assign(s,{useDebugFunction:t}));break;case"aliyun":e=Rs.init(Object.assign(s,{useDebugFunction:t}));break;case"private":e=tn.init(Object.assign(s,{useDebugFunction:t}));break;default:throw new Error("\u672A\u63D0\u4F9B\u6B63\u786E\u7684provider\u53C2\u6570")}return vt(e),e.reInit=function(){vt(this)},on(e),function(n){let r=n.uploadFile;n.uploadFile=function(o){return r.call(this,o)}}(e),un(e),function(n){n.getCurrentUserInfo=hn,n.chooseAndUploadFile=dn.initChooseAndUploadFile(n),Object.assign(n,{get mixinDatacom(){return Jt(n)}}),n.importObject=pn(n)}(e),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach(n=>{if(!e[n])return;let r=e[n];e[n]=function(){return e.reInit(),r.apply(e,Array.from(arguments))},e[n]=Dt(e[n],n).bind(e)}),e.init=this.init,e}};(()=>{{let s=Ds,e={};if(s.length===1)e=s[0],R=R.init(e),R.isDefault=!0;else{let t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","database","getCurrentUSerInfo","importObject"],n;n=s&&s.length>0?"\u5E94\u7528\u6709\u591A\u4E2A\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u901A\u8FC7uniCloud.init\u65B9\u6CD5\u6307\u5B9A\u8981\u4F7F\u7528\u7684\u670D\u52A1\u7A7A\u95F4":"\u5E94\u7528\u672A\u5173\u8054\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u5728uniCloud\u76EE\u5F55\u53F3\u952E\u5173\u8054\u670D\u52A1\u7A7A\u95F4",t.forEach(r=>{R[r]=function(){return console.error(n),Promise.reject(new C({code:"SYS_ERR",message:n}))}})}Object.assign(R,{get mixinDatacom(){return Jt(R)}}),cn(R),R.addInterceptor=bs,R.removeInterceptor=xs}})();var gn=R,mn={content:{"":{flex:1}}},yn={data(){return{latitude:39.909,longitude:116.39742}},onLoad(){let s=this;uni.getSystemInfo({success:e=>{s.mapHeight=e.screenHeight-e.statusBarHeight,s.mapHeight=s.mapHeight}})},methods:{getRemoteInfo(){gn.callFunction({name:"readPositionData",data:{deviceID:"80703833cbfcc1f9"}}).then(s=>{var e=s.result.data;J("log","at pages/map/map.nvue:38",e);let t=e[0].latitude,n=e[0].longitude;J("log","at pages/map/map.nvue:41","\u5F53\u524D\u7EAC\u5EA6\uFF1A"+t),J("log","at pages/map/map.nvue:42","\u5F53\u524D\u7ECF\u5EA6\uFF1A"+n),uni.openLocation({latitude:t,longitude:n,success:function(r){J("log","at pages/map/map.nvue:47",r)},fail:function(r){J("log","at pages/map/map.nvue:50",r)}})}).catch(s=>{J("log","at pages/map/map.nvue:54",s)})}}};function _n(s,e,t,n,r,o){return(0,$.openBlock)(),(0,$.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,$.createElementVNode)("view",{class:"content"},[(0,$.createElementVNode)("map",{scale:18,onTap:e[0]||(e[0]=i=>o.getRemoteInfo()),style:(0,$.normalizeStyle)([{width:"100%"},{height:s.mapHeight+"px"}]),longitude:r.longitude,latitude:r.latitude},null,44,["longitude","latitude"])])])}var Pe=st(yn,[["render",_n],["styles",[mn]]]);var Xe=plus.webview.currentWebview();if(Xe){let s=parseInt(Xe.id),e="pages/map/map",t={};try{t=JSON.parse(Xe.__query__)}catch(r){}Pe.mpType="page";let n=Vue.createPageApp(Pe,{$store:getApp({allowDefault:!0}).$store,__pageId:s,__pagePath:e,__pageQuery:t});n.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...Pe.styles||[]])),n.mount("#root")}})();
